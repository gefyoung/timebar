"use strict";var e=require("./defaultRoleAssumers-bc1a0bd5.js"),t=require("./serdePlugin-26c3933d.js"),n=require("./default-handler-b3f3c1c7.js"),r=require("stream"),a=require("fs");require("http2");var s=require("./index-9ffda90b.js");require("url"),require("buffer"),require("http"),require("os"),require("path"),require("crypto"),require("https"),require("process"),require("child_process"),require("./prerender-manifest.json"),require("./manifest.json"),require("./routes-manifest.json"),require("zlib"),require("perf_hooks");var o="3.30.0",i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function c(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o}function f(e){return this instanceof f?(this.v=e,this):new f(e)}var h=Object.freeze({__proto__:null,__extends:function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},get __assign(){return u},__rest:function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},__decorate:function(e,t,n,r){var a,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(o=(s<3?a(o):s>3?a(t,n,o):a(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},__param:function(e,t){return function(n,r){t(n,r,e)}},__metadata:function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter:function(e,t,n,r){return new(n||(n=Promise))((function(a,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function i(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}u((r=r.apply(e,t||[])).next())}))},__generator:function(e,t){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},__createBinding:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]},__exportStar:function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||(t[n]=e[n])},__values:c,__read:l,__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e},__spreadArrays:function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var s=arguments[t],o=0,i=s.length;o<i;o++,a++)r[a]=s[o];return r},__await:f,__asyncGenerator:function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){s.push([e,t,n,r])>1||i(e,t)}))})}function i(e,t){try{(n=a[e](t)).value instanceof f?Promise.resolve(n.value.v).then(u,c):l(s[0][2],n)}catch(e){l(s[0][3],e)}var n}function u(e){i("next",e)}function c(e){i("throw",e)}function l(e,t){e(t),s.shift(),s.length&&i(s[0][0],s[0][1])}},__asyncDelegator:function(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,a){t[r]=e[r]?function(t){return(n=!n)?{value:f(e[r](t)),done:"return"===r}:a?a(t):t}:a}},__asyncValues:function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=c(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,a,(t=e[n](t)).done,t.value)}))}}},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},__importDefault:function(e){return e&&e.__esModule?e:{default:e}},__classPrivateFieldGet:function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},__classPrivateFieldSet:function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}}),p=n.getAugmentedNamespace(h),d=n.createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Crc32=t.crc32=void 0,t.crc32=function(e){return(new n).update(e).digest()};var n=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(e){var t,n;try{for(var a=p.__values(e),s=a.next();!s.done;s=a.next()){var o=s.value;this.checksum=this.checksum>>>8^r[255&(this.checksum^o)]}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return this},e.prototype.digest=function(){return(4294967295^this.checksum)>>>0},e}();t.Crc32=n;var r=Uint32Array.from([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117])})),m=function(){function t(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}return t.fromNumber=function(e){if(e>0x8000000000000000||e<-0x8000000000000000)throw new Error(e+" is too large (or, if negative, too small) to represent as an Int64");for(var n=new Uint8Array(8),r=7,a=Math.abs(Math.round(e));r>-1&&a>0;r--,a/=256)n[r]=a;return e<0&&v(n),new t(n)},t.prototype.valueOf=function(){var t=this.bytes.slice(0),n=128&t[0];return n&&v(t),parseInt(e.toHex(t),16)*(n?-1:1)},t.prototype.toString=function(){return String(this.valueOf())},t}();function v(e){for(var t=0;t<8;t++)e[t]^=255;for(t=7;t>-1&&(e[t]++,0===e[t]);t--);}var w,y=function(){function n(e,t){this.toUtf8=e,this.fromUtf8=t}return n.prototype.format=function(e){var n,r,a,s,o=[];try{for(var i=t.__values(Object.keys(e)),u=i.next();!u.done;u=i.next()){var c=u.value,l=this.fromUtf8(c);o.push(Uint8Array.from([l.byteLength]),l,this.formatHeaderValue(e[c]))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}var f=new Uint8Array(o.reduce((function(e,t){return e+t.byteLength}),0)),h=0;try{for(var p=t.__values(o),d=p.next();!d.done;d=p.next()){var m=d.value;f.set(m,h),h+=m.byteLength}}catch(e){a={error:e}}finally{try{d&&!d.done&&(s=p.return)&&s.call(p)}finally{if(a)throw a.error}}return f},n.prototype.formatHeaderValue=function(t){switch(t.type){case"boolean":return Uint8Array.from([t.value?0:1]);case"byte":return Uint8Array.from([2,t.value]);case"short":var n=new DataView(new ArrayBuffer(3));return n.setUint8(0,3),n.setInt16(1,t.value,!1),new Uint8Array(n.buffer);case"integer":var r=new DataView(new ArrayBuffer(5));return r.setUint8(0,4),r.setInt32(1,t.value,!1),new Uint8Array(r.buffer);case"long":var a=new Uint8Array(9);return a[0]=5,a.set(t.value.bytes,1),a;case"binary":var s=new DataView(new ArrayBuffer(3+t.value.byteLength));s.setUint8(0,6),s.setUint16(1,t.value.byteLength,!1);var o=new Uint8Array(s.buffer);return o.set(t.value,3),o;case"string":var i=this.fromUtf8(t.value),u=new DataView(new ArrayBuffer(3+i.byteLength));u.setUint8(0,7),u.setUint16(1,i.byteLength,!1);var c=new Uint8Array(u.buffer);return c.set(i,3),c;case"timestamp":var l=new Uint8Array(9);return l[0]=8,l.set(m.fromNumber(t.value.valueOf()).bytes,1),l;case"uuid":if(!P.test(t.value))throw new Error("Invalid UUID received: "+t.value);var f=new Uint8Array(17);return f[0]=9,f.set(e.fromHex(t.value.replace(/\-/g,"")),1),f}},n.prototype.parse=function(t){for(var n={},r=0;r<t.byteLength;){var a=t.getUint8(r++),s=this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+r,a));switch(r+=a,t.getUint8(r++)){case 0:n[s]={type:g,value:!0};break;case 1:n[s]={type:g,value:!1};break;case 2:n[s]={type:_,value:t.getInt8(r++)};break;case 3:n[s]={type:b,value:t.getInt16(r,!1)},r+=2;break;case 4:n[s]={type:E,value:t.getInt32(r,!1)},r+=4;break;case 5:n[s]={type:S,value:new m(new Uint8Array(t.buffer,t.byteOffset+r,8))},r+=8;break;case 6:var o=t.getUint16(r,!1);r+=2,n[s]={type:A,value:new Uint8Array(t.buffer,t.byteOffset+r,o)},r+=o;break;case 7:var i=t.getUint16(r,!1);r+=2,n[s]={type:U,value:this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+r,i))},r+=i;break;case 8:n[s]={type:O,value:new Date(new m(new Uint8Array(t.buffer,t.byteOffset+r,8)).valueOf())},r+=8;break;case 9:var u=new Uint8Array(t.buffer,t.byteOffset+r,16);r+=16,n[s]={type:z,value:e.toHex(u.subarray(0,4))+"-"+e.toHex(u.subarray(4,6))+"-"+e.toHex(u.subarray(6,8))+"-"+e.toHex(u.subarray(8,10))+"-"+e.toHex(u.subarray(10))};break;default:throw new Error("Unrecognized header type tag")}}return n},n}();!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(w||(w={}));var g="boolean",_="byte",b="short",E="integer",S="long",A="binary",U="string",O="timestamp",z="uuid",P=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;var x=function(){function e(e,t){this.headerMarshaller=new y(e,t)}return e.prototype.marshall=function(e){var t=e.headers,n=e.body,r=this.headerMarshaller.format(t),a=r.byteLength+n.byteLength+16,s=new Uint8Array(a),o=new DataView(s.buffer,s.byteOffset,s.byteLength),i=new d.Crc32;return o.setUint32(0,a,!1),o.setUint32(4,r.byteLength,!1),o.setUint32(8,i.update(s.subarray(0,8)).digest(),!1),s.set(r,12),s.set(n,r.byteLength+12),o.setUint32(a-4,i.update(s.subarray(8,a-4)).digest(),!1),s},e.prototype.unmarshall=function(e){var t=function(e){var t=e.byteLength,n=e.byteOffset,r=e.buffer;if(t<16)throw new Error("Provided message too short to accommodate event stream message overhead");var a=new DataView(r,n,t),s=a.getUint32(0,!1);if(t!==s)throw new Error("Reported message length does not match received message length");var o=a.getUint32(4,!1),i=a.getUint32(8,!1),u=a.getUint32(t-4,!1),c=(new d.Crc32).update(new Uint8Array(r,n,8));if(i!==c.digest())throw new Error("The prelude checksum specified in the message ("+i+") does not match the calculated CRC32 checksum ("+c.digest()+")");if(c.update(new Uint8Array(r,n+8,t-12)),u!==c.digest())throw new Error("The message checksum ("+c.digest()+") did not match the expected value of "+u);return{headers:new DataView(r,n+8+4,o),body:new Uint8Array(r,n+8+4+o,s-o-16)}}(e),n=t.headers,r=t.body;return{headers:this.headerMarshaller.parse(n),body:r}},e.prototype.formatHeaders=function(e){return this.headerMarshaller.format(e)},e}();var I=function(){function e(e){var t=e.utf8Encoder,n=e.utf8Decoder;this.eventMarshaller=new x(t,n),this.utfEncoder=t}return e.prototype.deserialize=function(e,n){var r,a,s,o,i,u,c;return function(e,n){var r;return(r={})[Symbol.asyncIterator]=function(){return t.__asyncGenerator(this,arguments,(function(){var r,a,s,o,i,u,c,l,f,h,p,d,m,v,w,y,g;return t.__generator(this,(function(_){switch(_.label){case 0:_.trys.push([0,12,13,18]),r=t.__asyncValues(e),_.label=1;case 1:return[4,t.__await(r.next())];case 2:if((a=_.sent()).done)return[3,11];if(s=a.value,o=n.eventMarshaller.unmarshall(s),"error"!==(i=o.headers[":message-type"].value))return[3,3];throw(u=new Error(o.headers[":error-message"].value||"UnknownError")).name=o.headers[":error-code"].value,u;case 3:return"exception"!==i?[3,5]:(c=o.headers[":exception-type"].value,(v={})[c]=o,l=v,[4,t.__await(n.deserializer(l))]);case 4:if((f=_.sent()).$unknown)throw(h=new Error(n.toUtf8(o.body))).name=c,h;throw f[c];case 5:return"event"!==i?[3,9]:((w={})[o.headers[":event-type"].value]=o,p=w,[4,t.__await(n.deserializer(p))]);case 6:return(d=_.sent()).$unknown?[3,10]:[4,t.__await(d)];case 7:return[4,_.sent()];case 8:return _.sent(),[3,10];case 9:throw Error("Unrecognizable event type: "+o.headers[":event-type"].value);case 10:return[3,1];case 11:return[3,18];case 12:return m=_.sent(),y={error:m},[3,18];case 13:return _.trys.push([13,,16,17]),a&&!a.done&&(g=r.return)?[4,t.__await(g.call(r))]:[3,15];case 14:_.sent(),_.label=15;case 15:return[3,17];case 16:if(y)throw y.error;return[7];case 17:return[7];case 18:return[2]}}))}))},r}((r=e,s=0,o=0,i=null,u=null,c=function(e){if("number"!=typeof e)throw new Error("Attempted to allocate an event message where size was not a number: "+e);s=e,o=4,i=new Uint8Array(e),new DataView(i.buffer).setUint32(0,e,!1)},(a={})[Symbol.asyncIterator]=function(){return t.__asyncGenerator(this,arguments,(function(){var e,n,a,l,f,h,p,d;return t.__generator(this,(function(m){switch(m.label){case 0:e=r[Symbol.asyncIterator](),m.label=1;case 1:return[4,t.__await(e.next())];case 2:return n=m.sent(),a=n.value,n.done?s?[3,4]:[4,t.__await(void 0)]:[3,10];case 3:return[2,m.sent()];case 4:return s!==o?[3,7]:[4,t.__await(i)];case 5:return[4,m.sent()];case 6:return m.sent(),[3,8];case 7:throw new Error("Truncated event message received.");case 8:return[4,t.__await(void 0)];case 9:return[2,m.sent()];case 10:l=a.length,f=0,m.label=11;case 11:if(!(f<l))return[3,15];if(!i){if(h=l-f,u||(u=new Uint8Array(4)),p=Math.min(4-o,h),u.set(a.slice(f,f+p),o),f+=p,(o+=p)<4)return[3,15];c(new DataView(u.buffer).getUint32(0,!1)),u=null}return d=Math.min(s-o,l-f),i.set(a.slice(f,f+d),o),o+=d,f+=d,s&&s===o?[4,t.__await(i)]:[3,14];case 12:return[4,m.sent()];case 13:m.sent(),i=null,s=0,o=0,m.label=14;case 14:return[3,11];case 15:return[3,1];case 16:return[2]}}))}))},a),{eventMarshaller:this.eventMarshaller,deserializer:n,toUtf8:this.utfEncoder})},e.prototype.serialize=function(e,n){var r,a=this;return(r={})[Symbol.asyncIterator]=function(){return t.__asyncGenerator(this,arguments,(function(){var r,s,o,i,u,c,l;return t.__generator(this,(function(f){switch(f.label){case 0:f.trys.push([0,7,8,13]),r=t.__asyncValues(e),f.label=1;case 1:return[4,t.__await(r.next())];case 2:return(s=f.sent()).done?[3,6]:(o=s.value,i=a.eventMarshaller.marshall(n(o)),[4,t.__await(i)]);case 3:return[4,f.sent()];case 4:f.sent(),f.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return u=f.sent(),c={error:u},[3,13];case 8:return f.trys.push([8,,11,12]),s&&!s.done&&(l=r.return)?[4,t.__await(l.call(r))]:[3,10];case 9:f.sent(),f.label=10;case 10:return[3,12];case 11:if(c)throw c.error;return[7];case 12:return[7];case 13:return[4,t.__await(new Uint8Array(0))];case 14:return[4,f.sent()];case 15:return f.sent(),[2]}}))}))},r},e}();var k=function(){function e(e){var t=e.utf8Encoder,n=e.utf8Decoder;this.eventMarshaller=new x(t,n),this.universalMarshaller=new I({utf8Decoder:n,utf8Encoder:t})}return e.prototype.deserialize=function(e,n){var r="function"==typeof e[Symbol.asyncIterator]?e:function(e){return t.__asyncGenerator(this,arguments,(function(){var n,r,a,s;return t.__generator(this,(function(o){switch(o.label){case 0:n=!1,r=!1,a=new Array,e.on("error",(function(e){if(n||(n=!0),e)throw e})),e.on("data",(function(e){a.push(e)})),e.on("end",(function(){n=!0})),o.label=1;case 1:return r?[3,6]:[4,t.__await(new Promise((function(e){return setTimeout((function(){return e(a.shift())}),0)})))];case 2:return(s=o.sent())?[4,t.__await(s)]:[3,5];case 3:return[4,o.sent()];case 4:o.sent(),o.label=5;case 5:return r=n&&0===a.length,[3,1];case 6:return[2]}}))}))}(e);return this.universalMarshaller.deserialize(r,n)},e.prototype.serialize=function(e,n){var a=this.universalMarshaller.serialize(e,n);if("function"==typeof r.Readable.from)return r.Readable.from(a);var s=a[Symbol.asyncIterator](),o=new r.Readable({autoDestroy:!0,objectMode:!0,read:function(){return t.__awaiter(this,void 0,void 0,(function(){var e=this;return t.__generator(this,(function(t){return s.next().then((function(t){var n=t.done,r=t.value;n?e.push(null):e.push(r)})).catch((function(t){e.destroy(t)})),[2]}))}))}});return o.on("error",(function(){o.destroy()})),o.on("end",(function(){o.destroy()})),o},e}(),R=function(e){return new k(e)},C=function(e){function n(t,n){var r=e.call(this,n)||this;return r.hash=t,r}return t.__extends(n,e),n.prototype._write=function(e,t,n){try{this.hash.update(e)}catch(e){return n(e)}n()},n}(r.Writable),D=function(e,t){return new Promise((function(n,r){if("string"==typeof t.path){var s=a.createReadStream(t.path,{start:t.start,end:t.end}),o=new e,i=new C(o);s.pipe(i),s.on("error",(function(e){i.end(),r(e)})),i.on("error",r),i.on("finish",(function(){o.digest().then(n).catch(r)}))}else r(new Error("Unable to calculate hash for non-file streams."))}))};var N={environmentVariableSelector:function(e){if(Object.prototype.hasOwnProperty.call(e,"AWS_S3_USE_ARN_REGION")){if("true"===e.AWS_S3_USE_ARN_REGION)return!0;if("false"===e.AWS_S3_USE_ARN_REGION)return!1;throw new Error('Cannot load env AWS_S3_USE_ARN_REGION. Expected "true" or "false", got '+e.AWS_S3_USE_ARN_REGION+".")}},configFileSelector:function(e){if(Object.prototype.hasOwnProperty.call(e,"s3_use_arn_region")){if("true"===e.s3_use_arn_region)return!0;if("false"===e.s3_use_arn_region)return!1;throw new Error('Cannot load shared config entry s3_use_arn_region. Expected "true" or "false", got '+e.s3_use_arn_region+".")}},default:!1};const M={"accesspoint-af-south-1":{hostname:"s3-accesspoint.af-south-1.amazonaws.com"},"accesspoint-ap-east-1":{hostname:"s3-accesspoint.ap-east-1.amazonaws.com"},"accesspoint-ap-northeast-1":{hostname:"s3-accesspoint.ap-northeast-1.amazonaws.com"},"accesspoint-ap-northeast-2":{hostname:"s3-accesspoint.ap-northeast-2.amazonaws.com"},"accesspoint-ap-northeast-3":{hostname:"s3-accesspoint.ap-northeast-3.amazonaws.com"},"accesspoint-ap-south-1":{hostname:"s3-accesspoint.ap-south-1.amazonaws.com"},"accesspoint-ap-southeast-1":{hostname:"s3-accesspoint.ap-southeast-1.amazonaws.com"},"accesspoint-ap-southeast-2":{hostname:"s3-accesspoint.ap-southeast-2.amazonaws.com"},"accesspoint-ca-central-1":{hostname:"s3-accesspoint.ca-central-1.amazonaws.com"},"accesspoint-cn-north-1":{hostname:"s3-accesspoint.cn-north-1.amazonaws.com.cn"},"accesspoint-cn-northwest-1":{hostname:"s3-accesspoint.cn-northwest-1.amazonaws.com.cn"},"accesspoint-eu-central-1":{hostname:"s3-accesspoint.eu-central-1.amazonaws.com"},"accesspoint-eu-north-1":{hostname:"s3-accesspoint.eu-north-1.amazonaws.com"},"accesspoint-eu-south-1":{hostname:"s3-accesspoint.eu-south-1.amazonaws.com"},"accesspoint-eu-west-1":{hostname:"s3-accesspoint.eu-west-1.amazonaws.com"},"accesspoint-eu-west-2":{hostname:"s3-accesspoint.eu-west-2.amazonaws.com"},"accesspoint-eu-west-3":{hostname:"s3-accesspoint.eu-west-3.amazonaws.com"},"accesspoint-me-south-1":{hostname:"s3-accesspoint.me-south-1.amazonaws.com"},"accesspoint-sa-east-1":{hostname:"s3-accesspoint.sa-east-1.amazonaws.com"},"accesspoint-us-east-1":{hostname:"s3-accesspoint.us-east-1.amazonaws.com"},"accesspoint-us-east-2":{hostname:"s3-accesspoint.us-east-2.amazonaws.com"},"accesspoint-us-gov-east-1":{hostname:"s3-accesspoint.us-gov-east-1.amazonaws.com"},"accesspoint-us-gov-west-1":{hostname:"s3-accesspoint.us-gov-west-1.amazonaws.com"},"accesspoint-us-west-1":{hostname:"s3-accesspoint.us-west-1.amazonaws.com"},"accesspoint-us-west-2":{hostname:"s3-accesspoint.us-west-2.amazonaws.com"},"ap-northeast-1":{hostname:"s3.ap-northeast-1.amazonaws.com"},"ap-southeast-1":{hostname:"s3.ap-southeast-1.amazonaws.com"},"ap-southeast-2":{hostname:"s3.ap-southeast-2.amazonaws.com"},"aws-global":{hostname:"s3.amazonaws.com",signingRegion:"us-east-1"},"eu-west-1":{hostname:"s3.eu-west-1.amazonaws.com"},"fips-accesspoint-ca-central-1":{hostname:"s3-accesspoint-fips.ca-central-1.amazonaws.com"},"fips-accesspoint-us-east-1":{hostname:"s3-accesspoint-fips.us-east-1.amazonaws.com"},"fips-accesspoint-us-east-2":{hostname:"s3-accesspoint-fips.us-east-2.amazonaws.com"},"fips-accesspoint-us-gov-east-1":{hostname:"s3-accesspoint-fips.us-gov-east-1.amazonaws.com"},"fips-accesspoint-us-gov-west-1":{hostname:"s3-accesspoint-fips.us-gov-west-1.amazonaws.com"},"fips-accesspoint-us-west-1":{hostname:"s3-accesspoint-fips.us-west-1.amazonaws.com"},"fips-accesspoint-us-west-2":{hostname:"s3-accesspoint-fips.us-west-2.amazonaws.com"},"fips-us-gov-west-1":{hostname:"s3-fips.us-gov-west-1.amazonaws.com",signingRegion:"us-gov-west-1"},"s3-external-1":{hostname:"s3-external-1.amazonaws.com",signingRegion:"us-east-1"},"sa-east-1":{hostname:"s3.sa-east-1.amazonaws.com"},"us-east-1":{hostname:"s3.us-east-1.amazonaws.com"},"us-gov-east-1":{hostname:"s3.us-gov-east-1.amazonaws.com"},"us-gov-west-1":{hostname:"s3.us-gov-west-1.amazonaws.com"},"us-west-1":{hostname:"s3.us-west-1.amazonaws.com"},"us-west-2":{hostname:"s3.us-west-2.amazonaws.com"}},j={aws:{regions:["accesspoint-af-south-1","accesspoint-ap-east-1","accesspoint-ap-northeast-1","accesspoint-ap-northeast-2","accesspoint-ap-northeast-3","accesspoint-ap-south-1","accesspoint-ap-southeast-1","accesspoint-ap-southeast-2","accesspoint-ca-central-1","accesspoint-eu-central-1","accesspoint-eu-north-1","accesspoint-eu-south-1","accesspoint-eu-west-1","accesspoint-eu-west-2","accesspoint-eu-west-3","accesspoint-me-south-1","accesspoint-sa-east-1","accesspoint-us-east-1","accesspoint-us-east-2","accesspoint-us-west-1","accesspoint-us-west-2","af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","aws-global","ca-central-1","eu-central-1","eu-north-1","eu-south-1","eu-west-1","eu-west-2","eu-west-3","fips-accesspoint-ca-central-1","fips-accesspoint-us-east-1","fips-accesspoint-us-east-2","fips-accesspoint-us-west-1","fips-accesspoint-us-west-2","me-south-1","s3-external-1","sa-east-1","us-east-1","us-east-2","us-west-1","us-west-2"],hostname:"s3.{region}.amazonaws.com"},"aws-cn":{regions:["accesspoint-cn-north-1","accesspoint-cn-northwest-1","cn-north-1","cn-northwest-1"],hostname:"s3.{region}.amazonaws.com.cn"},"aws-iso":{regions:["us-iso-east-1"],hostname:"s3.{region}.c2s.ic.gov"},"aws-iso-b":{regions:["us-isob-east-1"],hostname:"s3.{region}.sc2s.sgov.gov"},"aws-us-gov":{regions:["accesspoint-us-gov-east-1","accesspoint-us-gov-west-1","fips-accesspoint-us-gov-east-1","fips-accesspoint-us-gov-west-1","fips-us-gov-west-1","us-gov-east-1","us-gov-west-1"],hostname:"s3.{region}.amazonaws.com"}},H=async(t,n)=>e.getRegionInfo(t,{...n,signingService:"s3",regionHash:M,partitionHash:j}),T=t=>{var n,r,a,s,i,u,c,l,f,h,p,d,m,v,w,y,g;e.emitWarningIfUnsupportedVersion(process.version);const _=(t=>{var n,r,a,s,o,i,u;return{apiVersion:"2006-03-01",disableHostPrefix:null!==(n=null==t?void 0:t.disableHostPrefix)&&void 0!==n&&n,logger:null!==(r=null==t?void 0:t.logger)&&void 0!==r?r:{},regionInfoProvider:null!==(a=null==t?void 0:t.regionInfoProvider)&&void 0!==a?a:H,serviceId:null!==(s=null==t?void 0:t.serviceId)&&void 0!==s?s:"S3",signingEscapePath:null!==(o=null==t?void 0:t.signingEscapePath)&&void 0!==o&&o,urlParser:null!==(i=null==t?void 0:t.urlParser)&&void 0!==i?i:e.parseUrl,useArnRegion:null!==(u=null==t?void 0:t.useArnRegion)&&void 0!==u&&u}})(t);return{..._,...t,runtime:"node",base64Decoder:null!==(n=null==t?void 0:t.base64Decoder)&&void 0!==n?n:e.fromBase64,base64Encoder:null!==(r=null==t?void 0:t.base64Encoder)&&void 0!==r?r:e.toBase64,bodyLengthChecker:null!==(a=null==t?void 0:t.bodyLengthChecker)&&void 0!==a?a:e.calculateBodyLength,credentialDefaultProvider:null!==(s=null==t?void 0:t.credentialDefaultProvider)&&void 0!==s?s:e.decorateDefaultCredentialProvider(e.defaultProvider),defaultUserAgentProvider:null!==(i=null==t?void 0:t.defaultUserAgentProvider)&&void 0!==i?i:e.defaultUserAgent({serviceId:_.serviceId,clientVersion:o}),eventStreamSerdeProvider:null!==(u=null==t?void 0:t.eventStreamSerdeProvider)&&void 0!==u?u:R,maxAttempts:null!==(c=null==t?void 0:t.maxAttempts)&&void 0!==c?c:e.loadConfig(e.NODE_MAX_ATTEMPT_CONFIG_OPTIONS),md5:null!==(l=null==t?void 0:t.md5)&&void 0!==l?l:e.Hash.bind(null,"md5"),region:null!==(f=null==t?void 0:t.region)&&void 0!==f?f:e.loadConfig(e.NODE_REGION_CONFIG_OPTIONS,e.NODE_REGION_CONFIG_FILE_OPTIONS),requestHandler:null!==(h=null==t?void 0:t.requestHandler)&&void 0!==h?h:new e.NodeHttpHandler,retryMode:null!==(p=null==t?void 0:t.retryMode)&&void 0!==p?p:e.loadConfig(e.NODE_RETRY_MODE_CONFIG_OPTIONS),sha256:null!==(d=null==t?void 0:t.sha256)&&void 0!==d?d:e.Hash.bind(null,"sha256"),streamCollector:null!==(m=null==t?void 0:t.streamCollector)&&void 0!==m?m:e.streamCollector,streamHasher:null!==(v=null==t?void 0:t.streamHasher)&&void 0!==v?v:D,useArnRegion:null!==(w=null==t?void 0:t.useArnRegion)&&void 0!==w?w:e.loadConfig(N),utf8Decoder:null!==(y=null==t?void 0:t.utf8Decoder)&&void 0!==y?y:e.fromUtf8,utf8Encoder:null!==(g=null==t?void 0:t.utf8Encoder)&&void 0!==g?g:e.toUtf8}};var q={step:"build",tags:["SET_EXPECT_HEADER","EXPECT_HEADER"],name:"addExpectContinueMiddleware",override:!0},L=function(e){return{applyToStack:function(n){n.add(function(e){var n=this;return function(r){return function(a){return t.__awaiter(n,void 0,void 0,(function(){var n;return t.__generator(this,(function(s){return n=a.request,t.HttpRequest.isInstance(n)&&n.body&&"node"===e.runtime&&(n.headers=t.__assign(t.__assign({},n.headers),{Expect:"100-continue"})),[2,r(t.__assign(t.__assign({},a),{request:n}))]}))}))}}}(e),q)}}};var G={step:"initialize",tags:["VALIDATE_BUCKET_NAME"],name:"validateBucketNameMiddleware",override:!0},V=function(e){return{applyToStack:function(e){e.add(function(){var e=this;return function(n){return function(r){return t.__awaiter(e,void 0,void 0,(function(){var e,a;return t.__generator(this,(function(o){if("string"==typeof(e=r.input.Bucket)&&!s.validate(e)&&e.indexOf("/")>=0)throw(a=new Error("Bucket name shouldn't contain '/', received '"+e+"'")).name="InvalidBucketName",a;return[2,n(t.__assign({},r))]}))}))}}}(),G)}}},B={step:"build",tags:["USE_REGIONAL_ENDPOINT","S3"],name:"useRegionalEndpointMiddleware",override:!0},F=function(e){return{applyToStack:function(n){n.add(function(e){return function(n){return function(r){return t.__awaiter(void 0,void 0,void 0,(function(){var a,s;return t.__generator(this,(function(o){switch(o.label){case 0:return a=r.request,!t.HttpRequest.isInstance(a)||e.isCustomEndpoint?[2,n(t.__assign({},r))]:"s3.amazonaws.com"!==a.hostname?[3,1]:(a.hostname="s3.us-east-1.amazonaws.com",[3,3]);case 1:return s="aws-global",[4,e.region()];case 2:s===o.sent()&&(a.hostname="s3.amazonaws.com"),o.label=3;case 3:return[2,n(t.__assign({},r))]}}))}))}}}(e),B)}}};class W extends t.Client{constructor(n){let r=T(n),a=e.resolveRegionConfig(r),s=e.resolveEndpointsConfig(a),o=e.resolveRetryConfig(s),i=e.resolveHostHeaderConfig(o),u=e.resolveAwsAuthConfig(i),c=(f=(l=u).bucketEndpoint,h=void 0!==f&&f,p=l.forcePathStyle,d=void 0!==p&&p,m=l.useAccelerateEndpoint,v=void 0!==m&&m,w=l.useDualstackEndpoint,y=void 0!==w&&w,g=l.useArnRegion,_=void 0!==g&&g,t.__assign(t.__assign({},l),{bucketEndpoint:h,forcePathStyle:d,useAccelerateEndpoint:v,useDualstackEndpoint:y,useArnRegion:"function"==typeof _?_:function(){return Promise.resolve(_)}}));var l,f,h,p,d,m,v,w,y,g,_;let b=function(e){return t.__assign(t.__assign({},e),{eventStreamMarshaller:e.eventStreamSerdeProvider(e)})}(e.resolveUserAgentConfig(c));super(b),this.config=b,this.middlewareStack.use(e.getRetryPlugin(this.config)),this.middlewareStack.use(e.getContentLengthPlugin(this.config)),this.middlewareStack.use(e.getHostHeaderPlugin(this.config)),this.middlewareStack.use(e.getLoggerPlugin(this.config)),this.middlewareStack.use(e.getAwsAuthPlugin(this.config)),this.middlewareStack.use(V(this.config)),this.middlewareStack.use(F(this.config)),this.middlewareStack.use(L(this.config)),this.middlewareStack.use(e.getUserAgentPlugin(this.config))}destroy(){super.destroy()}}exports.S3Client=W;
