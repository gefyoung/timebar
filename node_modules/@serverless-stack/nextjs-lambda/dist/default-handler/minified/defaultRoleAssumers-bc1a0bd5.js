"use strict";var e=require("./serdePlugin-26c3933d.js"),t=require("url"),n=require("buffer"),r=require("http"),i=require("fs"),o=require("os"),s=require("path"),a=require("crypto"),u=require("https"),c=require("stream");require("http2");var d=require("process"),l=require("child_process");function f(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var v,g,_,h,p,m,y,w,S,b,A,E,x,T,R,I,C,P,k,N,O,L,D,q,z,j,M,H,U,W=f(a),K="3.30.0";!function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(v||(v={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(g||(g={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(_||(_={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(h||(h={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(p||(p={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(m||(m={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(y||(y={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(w||(w={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(S||(S={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(b||(b={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(A||(A={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(E||(E={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(x||(x={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(T||(T={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(R||(R={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(I||(I={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(C||(C={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(P||(P={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(k||(k={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(N||(N={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(O||(O={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(L||(L={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(D||(D={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(q||(q={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(z||(z={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(j||(j={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(M||(M={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(H||(H={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(U||(U={}));var $=!1,F=function(e){e&&!$&&parseInt(e.substring(1,e.indexOf(".")))<12&&($=!0,process.emitWarning("The AWS SDK for JavaScript (v3) will\nno longer support Node.js "+e+" as of January 1, 2022.\nTo continue receiving updates to AWS services, bug fixes, and security\nupdates please upgrade to Node.js 12.x or later.\n\nMore information can be found at: https://a.co/1l6FLnu","NodeDeprecationWarning"))},B=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i,o,s,a,u,c,d,l,f,v;return e.__generator(this,(function(g){switch(g.label){case 0:return i=[e.__assign({},t)],v={},[4,be(t.body,n)];case 1:switch(r=e.__assign.apply(void 0,i.concat([(v.body=g.sent(),v)])),s="UnknownError",s=Ee(t,r.body),s){case"ExpiredTokenException":case"com.amazonaws.sts#ExpiredTokenException":return[3,2];case"MalformedPolicyDocumentException":case"com.amazonaws.sts#MalformedPolicyDocumentException":return[3,4];case"PackedPolicyTooLargeException":case"com.amazonaws.sts#PackedPolicyTooLargeException":return[3,6];case"RegionDisabledException":case"com.amazonaws.sts#RegionDisabledException":return[3,8]}return[3,10];case 2:return a=[{}],[4,G(r,n)];case 3:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,a.concat([g.sent()])),{name:s,$metadata:ye(t)}]),[3,11];case 4:return u=[{}],[4,Z(r,n)];case 5:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,u.concat([g.sent()])),{name:s,$metadata:ye(t)}]),[3,11];case 6:return c=[{}],[4,Q(r,n)];case 7:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,c.concat([g.sent()])),{name:s,$metadata:ye(t)}]),[3,11];case 8:return d=[{}],[4,ee(r,n)];case 9:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,d.concat([g.sent()])),{name:s,$metadata:ye(t)}]),[3,11];case 10:l=r.body,s=l.Error.code||l.Error.Code||s,o=e.__assign(e.__assign({},l.Error),{name:""+s,message:l.Error.message||l.Error.Message||s,$fault:"client",$metadata:ye(t)}),g.label=11;case 11:return f=o.message||o.Message||s,o.message=f,delete o.Message,[2,Promise.reject(Object.assign(new Error(f),o))]}}))}))},V=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i,o,s,a,u,c,d,l,f,v,g,_,h;return e.__generator(this,(function(p){switch(p.label){case 0:return i=[e.__assign({},t)],h={},[4,be(t.body,n)];case 1:switch(r=e.__assign.apply(void 0,i.concat([(h.body=p.sent(),h)])),s="UnknownError",s=Ee(t,r.body),s){case"ExpiredTokenException":case"com.amazonaws.sts#ExpiredTokenException":return[3,2];case"IDPCommunicationErrorException":case"com.amazonaws.sts#IDPCommunicationErrorException":return[3,4];case"IDPRejectedClaimException":case"com.amazonaws.sts#IDPRejectedClaimException":return[3,6];case"InvalidIdentityTokenException":case"com.amazonaws.sts#InvalidIdentityTokenException":return[3,8];case"MalformedPolicyDocumentException":case"com.amazonaws.sts#MalformedPolicyDocumentException":return[3,10];case"PackedPolicyTooLargeException":case"com.amazonaws.sts#PackedPolicyTooLargeException":return[3,12];case"RegionDisabledException":case"com.amazonaws.sts#RegionDisabledException":return[3,14]}return[3,16];case 2:return a=[{}],[4,G(r,n)];case 3:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,a.concat([p.sent()])),{name:s,$metadata:ye(t)}]),[3,17];case 4:return u=[{}],[4,X(r,n)];case 5:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,u.concat([p.sent()])),{name:s,$metadata:ye(t)}]),[3,17];case 6:return c=[{}],[4,Y(r,n)];case 7:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,c.concat([p.sent()])),{name:s,$metadata:ye(t)}]),[3,17];case 8:return d=[{}],[4,J(r,n)];case 9:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,d.concat([p.sent()])),{name:s,$metadata:ye(t)}]),[3,17];case 10:return l=[{}],[4,Z(r,n)];case 11:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,l.concat([p.sent()])),{name:s,$metadata:ye(t)}]),[3,17];case 12:return f=[{}],[4,Q(r,n)];case 13:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,f.concat([p.sent()])),{name:s,$metadata:ye(t)}]),[3,17];case 14:return v=[{}],[4,ee(r,n)];case 15:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,v.concat([p.sent()])),{name:s,$metadata:ye(t)}]),[3,17];case 16:g=r.body,s=g.Error.code||g.Error.Code||s,o=e.__assign(e.__assign({},g.Error),{name:""+s,message:g.Error.message||g.Error.Message||s,$fault:"client",$metadata:ye(t)}),p.label=17;case 17:return _=o.message||o.Message||s,o.message=_,delete o.Message,[2,Promise.reject(Object.assign(new Error(_),o))]}}))}))},G=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i;return e.__generator(this,(function(o){return r=t.body,i=fe(r.Error,n),[2,e.__assign({name:"ExpiredTokenException",$fault:"client",$metadata:ye(t)},i)]}))}))},X=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i;return e.__generator(this,(function(o){return r=t.body,i=ve(r.Error,n),[2,e.__assign({name:"IDPCommunicationErrorException",$fault:"client",$metadata:ye(t)},i)]}))}))},Y=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i;return e.__generator(this,(function(o){return r=t.body,i=ge(r.Error,n),[2,e.__assign({name:"IDPRejectedClaimException",$fault:"client",$metadata:ye(t)},i)]}))}))},J=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i;return e.__generator(this,(function(o){return r=t.body,i=_e(r.Error,n),[2,e.__assign({name:"InvalidIdentityTokenException",$fault:"client",$metadata:ye(t)},i)]}))}))},Z=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i;return e.__generator(this,(function(o){return r=t.body,i=he(r.Error,n),[2,e.__assign({name:"MalformedPolicyDocumentException",$fault:"client",$metadata:ye(t)},i)]}))}))},Q=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i;return e.__generator(this,(function(o){return r=t.body,i=pe(r.Error,n),[2,e.__assign({name:"PackedPolicyTooLargeException",$fault:"client",$metadata:ye(t)},i)]}))}))},ee=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i;return e.__generator(this,(function(o){return r=t.body,i=me(r.Error,n),[2,e.__assign({name:"RegionDisabledException",$fault:"client",$metadata:ye(t)},i)]}))}))},te=function(t,n){var r={};if(void 0!==t.RoleArn&&null!==t.RoleArn&&(r.RoleArn=t.RoleArn),void 0!==t.RoleSessionName&&null!==t.RoleSessionName&&(r.RoleSessionName=t.RoleSessionName),void 0!==t.PolicyArns&&null!==t.PolicyArns){var i=re(t.PolicyArns,n);Object.entries(i).forEach((function(t){var n=e.__read(t,2),i=n[0],o=n[1];r["PolicyArns."+i]=o}))}if(void 0!==t.Policy&&null!==t.Policy&&(r.Policy=t.Policy),void 0!==t.DurationSeconds&&null!==t.DurationSeconds&&(r.DurationSeconds=t.DurationSeconds),void 0!==t.Tags&&null!==t.Tags){i=ae(t.Tags,n);Object.entries(i).forEach((function(t){var n=e.__read(t,2),i=n[0],o=n[1];r["Tags."+i]=o}))}if(void 0!==t.TransitiveTagKeys&&null!==t.TransitiveTagKeys){i=se(t.TransitiveTagKeys,n);Object.entries(i).forEach((function(t){var n=e.__read(t,2),i=n[0],o=n[1];r["TransitiveTagKeys."+i]=o}))}return void 0!==t.ExternalId&&null!==t.ExternalId&&(r.ExternalId=t.ExternalId),void 0!==t.SerialNumber&&null!==t.SerialNumber&&(r.SerialNumber=t.SerialNumber),void 0!==t.TokenCode&&null!==t.TokenCode&&(r.TokenCode=t.TokenCode),void 0!==t.SourceIdentity&&null!==t.SourceIdentity&&(r.SourceIdentity=t.SourceIdentity),r},ne=function(t,n){var r={};if(void 0!==t.RoleArn&&null!==t.RoleArn&&(r.RoleArn=t.RoleArn),void 0!==t.RoleSessionName&&null!==t.RoleSessionName&&(r.RoleSessionName=t.RoleSessionName),void 0!==t.WebIdentityToken&&null!==t.WebIdentityToken&&(r.WebIdentityToken=t.WebIdentityToken),void 0!==t.ProviderId&&null!==t.ProviderId&&(r.ProviderId=t.ProviderId),void 0!==t.PolicyArns&&null!==t.PolicyArns){var i=re(t.PolicyArns,n);Object.entries(i).forEach((function(t){var n=e.__read(t,2),i=n[0],o=n[1];r["PolicyArns."+i]=o}))}return void 0!==t.Policy&&null!==t.Policy&&(r.Policy=t.Policy),void 0!==t.DurationSeconds&&null!==t.DurationSeconds&&(r.DurationSeconds=t.DurationSeconds),r},re=function(t,n){var r,i,o={},s=1;try{for(var a=e.__values(t),u=a.next();!u.done;u=a.next()){var c=u.value;if(null!==c){var d=ie(c,n);Object.entries(d).forEach((function(t){var n=e.__read(t,2),r=n[0],i=n[1];o["member."+s+"."+r]=i})),s++}}}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},ie=function(e,t){var n={};return void 0!==e.arn&&null!==e.arn&&(n.arn=e.arn),n},oe=function(e,t){var n={};return void 0!==e.Key&&null!==e.Key&&(n.Key=e.Key),void 0!==e.Value&&null!==e.Value&&(n.Value=e.Value),n},se=function(t,n){var r,i,o={},s=1;try{for(var a=e.__values(t),u=a.next();!u.done;u=a.next()){var c=u.value;null!==c&&(o["member."+s]=c,s++)}}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},ae=function(t,n){var r,i,o={},s=1;try{for(var a=e.__values(t),u=a.next();!u.done;u=a.next()){var c=u.value;if(null!==c){var d=oe(c);Object.entries(d).forEach((function(t){var n=e.__read(t,2),r=n[0],i=n[1];o["member."+s+"."+r]=i})),s++}}}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},ue=function(t,n){var r={AssumedRoleId:void 0,Arn:void 0};return void 0!==t.AssumedRoleId&&(r.AssumedRoleId=e.expectString(t.AssumedRoleId)),void 0!==t.Arn&&(r.Arn=e.expectString(t.Arn)),r},ce=function(t,n){var r={Credentials:void 0,AssumedRoleUser:void 0,PackedPolicySize:void 0,SourceIdentity:void 0};return void 0!==t.Credentials&&(r.Credentials=le(t.Credentials,n)),void 0!==t.AssumedRoleUser&&(r.AssumedRoleUser=ue(t.AssumedRoleUser)),void 0!==t.PackedPolicySize&&(r.PackedPolicySize=e.strictParseInt32(t.PackedPolicySize)),void 0!==t.SourceIdentity&&(r.SourceIdentity=e.expectString(t.SourceIdentity)),r},de=function(t,n){var r={Credentials:void 0,SubjectFromWebIdentityToken:void 0,AssumedRoleUser:void 0,PackedPolicySize:void 0,Provider:void 0,Audience:void 0,SourceIdentity:void 0};return void 0!==t.Credentials&&(r.Credentials=le(t.Credentials,n)),void 0!==t.SubjectFromWebIdentityToken&&(r.SubjectFromWebIdentityToken=e.expectString(t.SubjectFromWebIdentityToken)),void 0!==t.AssumedRoleUser&&(r.AssumedRoleUser=ue(t.AssumedRoleUser)),void 0!==t.PackedPolicySize&&(r.PackedPolicySize=e.strictParseInt32(t.PackedPolicySize)),void 0!==t.Provider&&(r.Provider=e.expectString(t.Provider)),void 0!==t.Audience&&(r.Audience=e.expectString(t.Audience)),void 0!==t.SourceIdentity&&(r.SourceIdentity=e.expectString(t.SourceIdentity)),r},le=function(t,n){var r={AccessKeyId:void 0,SecretAccessKey:void 0,SessionToken:void 0,Expiration:void 0};return void 0!==t.AccessKeyId&&(r.AccessKeyId=e.expectString(t.AccessKeyId)),void 0!==t.SecretAccessKey&&(r.SecretAccessKey=e.expectString(t.SecretAccessKey)),void 0!==t.SessionToken&&(r.SessionToken=e.expectString(t.SessionToken)),void 0!==t.Expiration&&(r.Expiration=new Date(t.Expiration)),r},fe=function(t,n){var r={message:void 0};return void 0!==t.message&&(r.message=e.expectString(t.message)),r},ve=function(t,n){var r={message:void 0};return void 0!==t.message&&(r.message=e.expectString(t.message)),r},ge=function(t,n){var r={message:void 0};return void 0!==t.message&&(r.message=e.expectString(t.message)),r},_e=function(t,n){var r={message:void 0};return void 0!==t.message&&(r.message=e.expectString(t.message)),r},he=function(t,n){var r={message:void 0};return void 0!==t.message&&(r.message=e.expectString(t.message)),r},pe=function(t,n){var r={message:void 0};return void 0!==t.message&&(r.message=e.expectString(t.message)),r},me=function(t,n){var r={message:void 0};return void 0!==t.message&&(r.message=e.expectString(t.message)),r},ye=function(e){var t;return{httpStatusCode:e.statusCode,requestId:null!==(t=e.headers["x-amzn-requestid"])&&void 0!==t?t:e.headers["x-amzn-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}},we=function(e,t){return function(e,t){return void 0===e&&(e=new Uint8Array),e instanceof Uint8Array?Promise.resolve(e):t.streamCollector(e)||Promise.resolve(new Uint8Array)}(e,t).then((function(e){return t.utf8Encoder(e)}))},Se=function(t,n,r,i,o){return e.__awaiter(void 0,void 0,void 0,(function(){var s,a,u,c,d,l,f;return e.__generator(this,(function(v){switch(v.label){case 0:return[4,t.endpoint()];case 1:return s=v.sent(),a=s.hostname,u=s.protocol,c=void 0===u?"https":u,d=s.port,l=s.path,f={protocol:c,hostname:a,port:d,method:"POST",path:l.endsWith("/")?l.slice(0,-1)+r:l+r,headers:n},void 0!==i&&(f.hostname=i),void 0!==o&&(f.body=o),[2,new e.HttpRequest(f)]}}))}))},be=function(t,n){return we(t,n).then((function(t){if(t.length){var n=e.parser.parse(t,{attributeNamePrefix:"",ignoreAttributes:!1,parseNodeValue:!1,trimValues:!1,tagValueProcessor:function(t){return""===t.trim()&&t.includes("\n")?"":e.lib.decodeHTML(t)}}),r=Object.keys(n)[0],i=n[r];return i["#text"]&&(i[r]=i["#text"],delete i["#text"]),e.getValueFromTextNode(i)}return{}}))},Ae=function(t){return Object.entries(t).map((function(t){var n=e.__read(t,2),r=n[0],i=n[1];return e.extendedEncodeURIComponent(r)+"="+e.extendedEncodeURIComponent(i)})).join("&")},Ee=function(e,t){return void 0!==t.Error.Code?t.Error.Code:404==e.statusCode?"NotFound":""},xe=function(t){function n(e,n){void 0===n&&(n=!0);var r=t.call(this,e)||this;return r.tryNextLink=n,r}return e.__extends(n,t),n.from=function(e,t){return void 0===t&&(t=!0),Object.defineProperty(e,"tryNextLink",{value:t,configurable:!1,enumerable:!1,writable:!1}),e},n}(Error),Te=function(t){function n(e,n){void 0===n&&(n=!0);var r=t.call(this,e)||this;return r.tryNextLink=n,r.name="CredentialsProviderError",r}return e.__extends(n,t),n.from=function(e,t){return void 0===t&&(t=!0),Object.defineProperty(e,"tryNextLink",{value:t,configurable:!1,enumerable:!1,writable:!1}),e},n}(Error);function Re(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(){var n,r,i=Promise.reject(new xe("No providers in chain")),o=function(e){i=i.catch((function(t){if(null==t?void 0:t.tryNextLink)return e();throw t}))};try{for(var s=e.__values(t),a=s.next();!a.done;a=s.next()){o(a.value)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i}}for(var Ie=function(t,n,r){var i,o,s,a=function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:o||(o=t()),e.label=1;case 1:return e.trys.push([1,,3,4]),[4,o];case 2:return i=e.sent(),s=!0,[3,4];case 3:return o=void 0,[7];case 4:return[2,i]}}))}))};if(void 0===n)return function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:return s?[3,2]:[4,a()];case 1:i=e.sent(),e.label=2;case 2:return[2,i]}}))}))};var u=!1;return function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:return s?[3,2]:[4,a()];case 1:i=e.sent(),e.label=2;case 2:return u?[2,i]:r&&!r(i)?(u=!0,[2,i]):n(i)?[4,a()]:[3,4];case 3:return e.sent(),[2,i];case 4:return[2,i]}}))}))}},Ce={},Pe={},ke=0;ke<256;ke++){var Ne=ke.toString(16).toLowerCase();1===Ne.length&&(Ne="0"+Ne),Ce[ke]=Ne,Pe[Ne]=ke}function Oe(e){for(var t="",n=0;n<e.byteLength;n++)t+=Ce[e[n]];return t}var Le="X-Amz-Date".toLowerCase(),De=["authorization",Le,"date"],qe="X-Amz-Signature".toLowerCase(),ze="X-Amz-Security-Token".toLowerCase(),je={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},Me=/^proxy-/,He=/^sec-/,Ue="AWS4-HMAC-SHA256-PAYLOAD",We={},Ke=[];function $e(e,t,n){return e+"/"+t+"/"+n+"/aws4_request"}function Fe(e,t,n){var r=new e(t);return r.update(n),r.digest()}function Be(t,n,r){var i,o,s=t.headers,a={};try{for(var u=e.__values(Object.keys(s).sort()),c=u.next();!c.done;c=u.next()){var d=c.value,l=d.toLowerCase();(l in je||(null==n?void 0:n.has(l))||Me.test(l)||He.test(l))&&(!r||r&&!r.has(l))||(a[l]=s[d].trim().replace(/\s+/g," "))}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return a}var Ve=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,Ge)},Ge=function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()};var Xe=function(e){return"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e)};function Ye(t,n){var r=t.headers,i=t.body;return e.__awaiter(this,void 0,void 0,(function(){var t,o,s,a,u,c,d;return e.__generator(this,(function(l){switch(l.label){case 0:try{for(t=e.__values(Object.keys(r)),o=t.next();!o.done;o=t.next())if("x-amz-content-sha256"===(s=o.value).toLowerCase())return[2,r[s]]}catch(e){c={error:e}}finally{try{o&&!o.done&&(d=t.return)&&d.call(t)}finally{if(c)throw c.error}}return null!=i?[3,1]:[2,"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"];case 1:return"string"==typeof i||ArrayBuffer.isView(i)||Xe(i)?((a=new n).update(i),u=Oe,[4,a.digest()]):[3,3];case 2:return[2,u.apply(void 0,[l.sent()])];case 3:return[2,"UNSIGNED-PAYLOAD"]}}))}))}function Je(t){var n=t.headers,r=t.query,i=e.__rest(t,["headers","query"]);return e.__assign(e.__assign({},i),{headers:e.__assign({},n),query:r?Ze(r):void 0})}function Ze(t){return Object.keys(t).reduce((function(n,r){var i,o=t[r];return e.__assign(e.__assign({},n),((i={})[r]=Array.isArray(o)?e.__spreadArray([],e.__read(o),!1):o,i))}),{})}function Qe(t){var n,r;t="function"==typeof t.clone?t.clone():Je(t);try{for(var i=e.__values(Object.keys(t.headers)),o=i.next();!o.done;o=i.next()){var s=o.value;De.indexOf(s.toLowerCase())>-1&&delete t.headers[s]}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return t}function et(e){return function(e){if("number"==typeof e)return new Date(1e3*e);if("string"==typeof e)return Number(e)?new Date(1e3*Number(e)):new Date(e);return e}(e).toISOString().replace(/\.\d{3}Z$/,"Z")}var tt=function(){function t(e){var t=e.applyChecksum,n=e.credentials,r=e.region,i=e.service,o=e.sha256,s=e.uriEscapePath,a=void 0===s||s;this.service=i,this.sha256=o,this.uriEscapePath=a,this.applyChecksum="boolean"!=typeof t||t,this.regionProvider=it(r),this.credentialProvider=ot(n)}return t.prototype.presign=function(t,n){return void 0===n&&(n={}),e.__awaiter(this,void 0,void 0,(function(){var r,i,o,s,a,u,c,d,l,f,v,g,_,h,p,m,y,w,S,b,A,E,x,T;return e.__generator(this,(function(R){switch(R.label){case 0:return r=n.signingDate,i=void 0===r?new Date:r,o=n.expiresIn,s=void 0===o?3600:o,a=n.unsignableHeaders,u=n.unhoistableHeaders,c=n.signableHeaders,d=n.signingRegion,l=n.signingService,[4,this.credentialProvider()];case 1:return f=R.sent(),null==d?[3,2]:(g=d,[3,4]);case 2:return[4,this.regionProvider()];case 3:g=R.sent(),R.label=4;case 4:return v=g,_=nt(i),h=_.longDate,p=_.shortDate,s>604800?[2,Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future")]:(m=$e(p,v,null!=l?l:this.service),y=function(t,n){var r,i,o;void 0===n&&(n={});var s="function"==typeof t.clone?t.clone():Je(t),a=s.headers,u=s.query,c=void 0===u?{}:u;try{for(var d=e.__values(Object.keys(a)),l=d.next();!l.done;l=d.next()){var f=l.value,v=f.toLowerCase();"x-amz-"!==v.substr(0,6)||(null===(o=n.unhoistableHeaders)||void 0===o?void 0:o.has(v))||(c[f]=a[f],delete a[f])}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}return e.__assign(e.__assign({},t),{headers:a,query:c})}(Qe(t),{unhoistableHeaders:u}),f.sessionToken&&(y.query["X-Amz-Security-Token"]=f.sessionToken),y.query["X-Amz-Algorithm"]="AWS4-HMAC-SHA256",y.query["X-Amz-Credential"]=f.accessKeyId+"/"+m,y.query["X-Amz-Date"]=h,y.query["X-Amz-Expires"]=s.toString(10),w=Be(y,a,c),y.query["X-Amz-SignedHeaders"]=rt(w),S=y.query,b="X-Amz-Signature",A=this.getSignature,E=[h,m,this.getSigningKey(f,v,p,l)],x=this.createCanonicalRequest,T=[y,w],[4,Ye(t,this.sha256)]);case 5:return[4,A.apply(this,E.concat([x.apply(this,T.concat([R.sent()]))]))];case 6:return S[b]=R.sent(),[2,y]}}))}))},t.prototype.sign=function(t,n){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return"string"==typeof t?[2,this.signString(t,n)]:t.headers&&t.payload?[2,this.signEvent(t,n)]:[2,this.signRequest(t,n)]}))}))},t.prototype.signEvent=function(t,n){var r=t.headers,i=t.payload,o=n.signingDate,s=void 0===o?new Date:o,a=n.priorSignature,u=n.signingRegion,c=n.signingService;return e.__awaiter(this,void 0,void 0,(function(){var t,n,o,d,l,f,v,g,_,h,p;return e.__generator(this,(function(e){switch(e.label){case 0:return null==u?[3,1]:(n=u,[3,3]);case 1:return[4,this.regionProvider()];case 2:n=e.sent(),e.label=3;case 3:return t=n,o=nt(s),d=o.shortDate,l=o.longDate,f=$e(d,t,null!=c?c:this.service),[4,Ye({headers:{},body:i},this.sha256)];case 4:return v=e.sent(),(g=new this.sha256).update(r),h=Oe,[4,g.digest()];case 5:return _=h.apply(void 0,[e.sent()]),p=[Ue,l,f,a,_,v].join("\n"),[2,this.signString(p,{signingDate:s,signingRegion:t,signingService:c})]}}))}))},t.prototype.signString=function(t,n){var r=void 0===n?{}:n,i=r.signingDate,o=void 0===i?new Date:i,s=r.signingRegion,a=r.signingService;return e.__awaiter(this,void 0,void 0,(function(){var n,r,i,u,c,d,l,f;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,this.credentialProvider()];case 1:return n=e.sent(),null==s?[3,2]:(i=s,[3,4]);case 2:return[4,this.regionProvider()];case 3:i=e.sent(),e.label=4;case 4:return r=i,u=nt(o).shortDate,l=(d=this.sha256).bind,[4,this.getSigningKey(n,r,u,a)];case 5:return(c=new(l.apply(d,[void 0,e.sent()]))).update(t),f=Oe,[4,c.digest()];case 6:return[2,f.apply(void 0,[e.sent()])]}}))}))},t.prototype.signRequest=function(t,n){var r=void 0===n?{}:n,i=r.signingDate,o=void 0===i?new Date:i,s=r.signableHeaders,a=r.unsignableHeaders,u=r.signingRegion,c=r.signingService;return e.__awaiter(this,void 0,void 0,(function(){var n,r,i,d,l,f,v,g,_,h,p;return e.__generator(this,(function(m){switch(m.label){case 0:return[4,this.credentialProvider()];case 1:return n=m.sent(),null==u?[3,2]:(i=u,[3,4]);case 2:return[4,this.regionProvider()];case 3:i=m.sent(),m.label=4;case 4:return r=i,d=Qe(t),l=nt(o),f=l.longDate,v=l.shortDate,g=$e(v,r,null!=c?c:this.service),d.headers[Le]=f,n.sessionToken&&(d.headers[ze]=n.sessionToken),[4,Ye(d,this.sha256)];case 5:return _=m.sent(),!function(t,n){var r,i;t=t.toLowerCase();try{for(var o=e.__values(Object.keys(n)),s=o.next();!s.done;s=o.next())if(t===s.value.toLowerCase())return!0}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return!1}("x-amz-content-sha256",d.headers)&&this.applyChecksum&&(d.headers["x-amz-content-sha256"]=_),h=Be(d,a,s),[4,this.getSignature(f,g,this.getSigningKey(n,r,v,c),this.createCanonicalRequest(d,h,_))];case 6:return p=m.sent(),d.headers.authorization="AWS4-HMAC-SHA256 Credential="+n.accessKeyId+"/"+g+", SignedHeaders="+rt(h)+", Signature="+p,[2,d]}}))}))},t.prototype.createCanonicalRequest=function(t,n,r){var i=Object.keys(n).sort();return t.method+"\n"+this.getCanonicalPath(t)+"\n"+function(t){var n,r,i=t.query,o=void 0===i?{}:i,s=[],a={},u=function(e){if(e.toLowerCase()===qe)return"continue";s.push(e);var t=o[e];"string"==typeof t?a[e]=Ve(e)+"="+Ve(t):Array.isArray(t)&&(a[e]=t.slice(0).sort().reduce((function(t,n){return t.concat([Ve(e)+"="+Ve(n)])}),[]).join("&"))};try{for(var c=e.__values(Object.keys(o).sort()),d=c.next();!d.done;d=c.next())u(d.value)}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return s.map((function(e){return a[e]})).filter((function(e){return e})).join("&")}(t)+"\n"+i.map((function(e){return e+":"+n[e]})).join("\n")+"\n\n"+i.join(";")+"\n"+r},t.prototype.createStringToSign=function(t,n,r){return e.__awaiter(this,void 0,void 0,(function(){var i,o;return e.__generator(this,(function(e){switch(e.label){case 0:return(i=new this.sha256).update(r),[4,i.digest()];case 1:return o=e.sent(),[2,"AWS4-HMAC-SHA256\n"+t+"\n"+n+"\n"+Oe(o)]}}))}))},t.prototype.getCanonicalPath=function(e){var t=e.path;return this.uriEscapePath?"/"+encodeURIComponent(t.replace(/^\//,"")).replace(/%2F/g,"/"):t},t.prototype.getSignature=function(t,n,r,i){return e.__awaiter(this,void 0,void 0,(function(){var o,s,a,u,c;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,this.createStringToSign(t,n,i)];case 1:return o=e.sent(),u=(a=this.sha256).bind,[4,r];case 2:return(s=new(u.apply(a,[void 0,e.sent()]))).update(o),c=Oe,[4,s.digest()];case 3:return[2,c.apply(void 0,[e.sent()])]}}))}))},t.prototype.getSigningKey=function(t,n,r,i){return function(t,n,r,i,o){return e.__awaiter(void 0,void 0,void 0,(function(){var s,a,u,c,d,l,f,v,g;return e.__generator(this,(function(_){switch(_.label){case 0:return[4,Fe(t,n.secretAccessKey,n.accessKeyId)];case 1:if(s=_.sent(),(a=r+":"+i+":"+o+":"+Oe(s)+":"+n.sessionToken)in We)return[2,We[a]];for(Ke.push(a);Ke.length>50;)delete We[Ke.shift()];u="AWS4"+n.secretAccessKey,_.label=2;case 2:_.trys.push([2,7,8,9]),c=e.__values([r,i,o,"aws4_request"]),d=c.next(),_.label=3;case 3:return d.done?[3,6]:(l=d.value,[4,Fe(t,u,l)]);case 4:u=_.sent(),_.label=5;case 5:return d=c.next(),[3,3];case 6:return[3,9];case 7:return f=_.sent(),v={error:f},[3,9];case 8:try{d&&!d.done&&(g=c.return)&&g.call(c)}finally{if(v)throw v.error}return[7];case 9:return[2,We[a]=u]}}))}))}(this.sha256,t,r,n,i||this.service)},t}(),nt=function(e){var t=et(e).replace(/[\-:]/g,"");return{longDate:t,shortDate:t.substr(0,8)}},rt=function(e){return Object.keys(e).sort().join(";")},it=function(e){if("string"==typeof e){var t=Promise.resolve(e);return function(){return t}}return e},ot=function(e){if("object"==typeof e){var t=Promise.resolve(e);return function(){return t}}return e},st=function(t){var n,r=t.credentials?ut(t.credentials):t.credentialDefaultProvider(t),i=t.signingEscapePath,o=void 0===i||i,s=t.systemClockOffset,a=void 0===s?t.systemClockOffset||0:s,u=t.sha256;return n=t.signer?at(t.signer):function(){return at(t.region)().then((function(n){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:return[4,t.regionInfoProvider(n)];case 1:return[2,[e.sent()||{},n]]}}))}))})).then((function(n){var i=e.__read(n,2),s=i[0],a=i[1],c=s.signingRegion,d=s.signingService;return t.signingRegion=t.signingRegion||c||a,t.signingName=t.signingName||d||t.serviceId,new tt({credentials:r,region:t.signingRegion,service:t.signingName,sha256:u,uriEscapePath:o})}))},e.__assign(e.__assign({},t),{systemClockOffset:a,signingEscapePath:o,credentials:r,signer:n})},at=function(e){if("object"==typeof e){var t=Promise.resolve(e);return function(){return t}}return e},ut=function(e){return"function"==typeof e?Ie(e,(function(e){return void 0!==e.expiration&&e.expiration.getTime()-Date.now()<3e5}),(function(e){return void 0!==e.expiration})):at(e)},ct=function(e){return new Date(Date.now()+e)},dt=function(e,t){var n=Date.parse(e);return function(e,t){return Math.abs(ct(t).getTime()-e)>=3e5}(n,t)?n-Date.now():t},lt={name:"awsAuthMiddleware",tags:["SIGNATURE","AWSAUTH"],relation:"after",toMiddleware:"retryMiddleware",override:!0},ft=function(t){return{applyToStack:function(n){n.addRelativeTo(function(t){return function(n,r){return function(i){return e.__awaiter(this,void 0,void 0,(function(){var o,s,a,u,c,d,l;return e.__generator(this,(function(f){switch(f.label){case 0:return e.HttpRequest.isInstance(i.request)?[4,t.signer()]:[2,n(i)];case 1:return o=f.sent(),a=n,u=[e.__assign({},i)],l={},[4,o.sign(i.request,{signingDate:ct(t.systemClockOffset),signingRegion:r.signing_region,signingService:r.signing_service})];case 2:return[4,a.apply(void 0,[e.__assign.apply(void 0,u.concat([(l.request=f.sent(),l)]))]).catch((function(e){throw e.ServerTime&&(t.systemClockOffset=dt(e.ServerTime,t.systemClockOffset)),e}))];case 3:return s=f.sent(),c=s.response.headers,(d=c&&(c.date||c.Date))&&(t.systemClockOffset=dt(d,t.systemClockOffset)),[2,s]}}))}))}}}(t),lt)}}},vt=function(t){function n(e){var n=t.call(this)||this;return n.input=e,n}return e.__extends(n,t),n.prototype.resolveMiddleware=function(t,n,r){this.middlewareStack.use(e.getSerdePlugin(n,this.serialize,this.deserialize)),this.middlewareStack.use(ft(n));var i=t.concat(this.middlewareStack),o={logger:n.logger,clientName:"STSClient",commandName:"AssumeRoleCommand",inputFilterSensitiveLog:h.filterSensitiveLog,outputFilterSensitiveLog:m.filterSensitiveLog},s=n.requestHandler;return i.resolve((function(e){return s.handle(e.request,r||{})}),o)},n.prototype.serialize=function(t,n){return function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i;return e.__generator(this,(function(o){return r={"content-type":"application/x-www-form-urlencoded"},i=Ae(e.__assign(e.__assign({},te(t,n)),{Action:"AssumeRole",Version:"2011-06-15"})),[2,Se(n,r,"/",void 0,i)]}))}))}(t,n)},n.prototype.deserialize=function(t,n){return function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i,o;return e.__generator(this,(function(s){switch(s.label){case 0:return t.statusCode>=300?[2,B(t,n)]:[4,be(t.body,n)];case 1:return r=s.sent(),i=ce(r.AssumeRoleResult,n),o=e.__assign({$metadata:ye(t)},i),[2,Promise.resolve(o)]}}))}))}(t,n)},n}(e.Command),gt=function(t){function n(e){var n=t.call(this)||this;return n.input=e,n}return e.__extends(n,t),n.prototype.resolveMiddleware=function(t,n,r){this.middlewareStack.use(e.getSerdePlugin(n,this.serialize,this.deserialize));var i=t.concat(this.middlewareStack),o={logger:n.logger,clientName:"STSClient",commandName:"AssumeRoleWithWebIdentityCommand",inputFilterSensitiveLog:R.filterSensitiveLog,outputFilterSensitiveLog:I.filterSensitiveLog},s=n.requestHandler;return i.resolve((function(e){return s.handle(e.request,r||{})}),o)},n.prototype.serialize=function(t,n){return function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i;return e.__generator(this,(function(o){return r={"content-type":"application/x-www-form-urlencoded"},i=Ae(e.__assign(e.__assign({},ne(t,n)),{Action:"AssumeRoleWithWebIdentity",Version:"2011-06-15"})),[2,Se(n,r,"/",void 0,i)]}))}))}(t,n)},n.prototype.deserialize=function(t,n){return function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i,o;return e.__generator(this,(function(s){switch(s.label){case 0:return t.statusCode>=300?[2,V(t,n)]:[4,be(t.body,n)];case 1:return r=s.sent(),i=de(r.AssumeRoleWithWebIdentityResult,n),o=e.__assign({$metadata:ye(t)},i),[2,Promise.resolve(o)]}}))}))}(t,n)},n}(e.Command),_t=function(t){return"function"!=typeof t?void 0===t?"us-east-1":t:function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,t()];case 1:return[2,e.sent()];case 2:return e.sent(),[2,"us-east-1"];case 3:return[2]}}))}))}},ht=function(t,n){var r,i;return function(o,s){return e.__awaiter(void 0,void 0,void 0,(function(){var a,u,c,d;return e.__generator(this,(function(l){switch(l.label){case 0:return i=o,r||(a=t.logger,u=t.region,c=t.requestHandler,r=new n(e.__assign({logger:a,credentialDefaultProvider:function(){return function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,i]}))}))}},region:_t(u||t.region)},c?{requestHandler:c}:{}))),[4,r.send(new vt(s))];case 1:if(!(d=l.sent().Credentials)||!d.AccessKeyId||!d.SecretAccessKey)throw new Error("Invalid response from STS.assumeRole call with role "+s.RoleArn);return[2,{accessKeyId:d.AccessKeyId,secretAccessKey:d.SecretAccessKey,sessionToken:d.SessionToken,expiration:d.Expiration}]}}))}))}},pt=function(t,n){var r;return function(i){return e.__awaiter(void 0,void 0,void 0,(function(){var o,s,a,u;return e.__generator(this,(function(c){switch(c.label){case 0:return r||(o=t.logger,s=t.region,a=t.requestHandler,r=new n(e.__assign({logger:o,region:_t(s||t.region)},a?{requestHandler:a}:{}))),[4,r.send(new gt(i))];case 1:if(!(u=c.sent().Credentials)||!u.AccessKeyId||!u.SecretAccessKey)throw new Error("Invalid response from STS.assumeRoleWithWebIdentity call with role "+i.RoleArn);return[2,{accessKeyId:u.AccessKeyId,secretAccessKey:u.SecretAccessKey,sessionToken:u.SessionToken,expiration:u.Expiration}]}}))}))}},mt=function(e){var t=e.endpoint,n=e.urlParser;if("string"==typeof t){var r=Promise.resolve(n(t));return function(){return r}}if("object"==typeof t){var i=Promise.resolve(t);return function(){return i}}return t},yt=function(t){var n;return e.__assign(e.__assign({},t),{tls:null===(n=t.tls)||void 0===n||n,endpoint:t.endpoint?mt(e.__assign(e.__assign({},t),{endpoint:t.endpoint})):function(){return function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var n,r,i,o,s;return e.__generator(this,(function(e){switch(e.label){case 0:return n=t.tls,r=void 0===n||n,[4,t.region()];case 1:if(i=e.sent(),!new RegExp(/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9])$/).test(i))throw new Error("Invalid region in client config");return[4,t.regionInfoProvider(i)];case 2:if(!(o=(null!==(s=e.sent())&&void 0!==s?s:{}).hostname))throw new Error("Cannot resolve hostname from client config");return[2,t.urlParser((r?"https:":"http:")+"//"+o)]}}))}))}(t)},isCustomEndpoint:!!t.endpoint})},wt={environmentVariableSelector:function(e){return e.AWS_REGION},configFileSelector:function(e){return e.region},default:function(){throw new Error("Region is missing")}},St={preferredFile:"credentials"},bt=function(e){if("string"==typeof e){var t=Promise.resolve(e);return function(){return t}}return e},At=function(t){if(!t.region)throw new Error("Region is missing");return e.__assign(e.__assign({},t),{region:bt(t.region)})},Et=function(e,t){var n,r=t.partitionHash;return null!==(n=Object.keys(r||{}).find((function(t){return r[t].regions.includes(e)})))&&void 0!==n?n:"aws"},xt=function(e,t){var n,r,i=t.signingService,o=t.regionHash,s=t.partitionHash;return null!==(r=null===(n=o[e])||void 0===n?void 0:n.hostname)&&void 0!==r?r:function(e,t){var n,r,i=t.signingService,o=t.partitionHash;return null!==(r=null===(n=o[Et(e,{partitionHash:o})])||void 0===n?void 0:n.hostname)&&void 0!==r?r:"{signingService}.{region}.amazonaws.com".replace("{signingService}",i)}(e,{signingService:i,partitionHash:s}).replace("{region}",e)},Tt=function(t,n){var r,i,o,s,a=n.signingService,u=n.regionHash,c=n.partitionHash,d=Et(t,{partitionHash:c}),l=null!==(i=null===(r=c[d])||void 0===r?void 0:r.endpoint)&&void 0!==i?i:t;return e.__assign(e.__assign({partition:d,signingService:a,hostname:xt(l,{signingService:a,regionHash:u,partitionHash:c})},(null===(o=u[l])||void 0===o?void 0:o.signingRegion)&&{signingRegion:u[l].signingRegion}),(null===(s=u[l])||void 0===s?void 0:s.signingService)&&{signingService:u[l].signingService})};function Rt(){return function(){var e=process.env.AWS_ACCESS_KEY_ID,t=process.env.AWS_SECRET_ACCESS_KEY,n=process.env.AWS_CREDENTIAL_EXPIRATION;return e&&t?Promise.resolve({accessKeyId:e,secretAccessKey:t,sessionToken:process.env.AWS_SESSION_TOKEN,expiration:n?new Date(n):void 0}):Promise.reject(new Te("Unable to find environment variable credentials."))}}function It(t){return new Promise((function(i,o){var s,a=r.request(e.__assign(e.__assign({method:"GET"},t),{hostname:null===(s=t.hostname)||void 0===s?void 0:s.replace(/^\[(.+)\]$/,"$1")}));a.on("error",(function(e){o(Object.assign(new xe("Unable to connect to instance metadata service"),e)),a.destroy()})),a.on("timeout",(function(){o(new xe("TimeoutError from instance metadata service")),a.destroy()})),a.on("response",(function(e){var t=e.statusCode,r=void 0===t?400:t;(r<200||300<=r)&&(o(Object.assign(new xe("Error response received from instance metadata service"),{statusCode:r})),a.destroy());var s=[];e.on("data",(function(e){s.push(e)})),e.on("end",(function(){i(n.Buffer.concat(s)),a.destroy()}))})),a.end()}))}var Ct=function(e){return Boolean(e)&&"object"==typeof e&&"string"==typeof e.AccessKeyId&&"string"==typeof e.SecretAccessKey&&"string"==typeof e.Token&&"string"==typeof e.Expiration},Pt=function(e){return{accessKeyId:e.AccessKeyId,secretAccessKey:e.SecretAccessKey,sessionToken:e.Token,expiration:new Date(e.Expiration)}},kt=function(e){var t=e.maxRetries,n=void 0===t?0:t,r=e.timeout;return{maxRetries:n,timeout:void 0===r?1e3:r}},Nt=function(e,t){for(var n=e(),r=0;r<t;r++)n=n.catch(e);return n},Ot="AWS_CONTAINER_CREDENTIALS_FULL_URI",Lt="AWS_CONTAINER_CREDENTIALS_RELATIVE_URI",Dt=function(t){void 0===t&&(t={});var n=kt(t),r=n.timeout,i=n.maxRetries;return function(){return Nt((function(){return e.__awaiter(void 0,void 0,void 0,(function(){var t,n,i,o;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,Mt()];case 1:return t=e.sent(),o=(i=JSON).parse,[4,qt(r,t)];case 2:if(n=o.apply(i,[e.sent()]),!Ct(n))throw new Te("Invalid response received from instance metadata service.");return[2,Pt(n)]}}))}))}),i)}},qt=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(r){switch(r.label){case 0:return process.env.AWS_CONTAINER_AUTHORIZATION_TOKEN&&(n.headers=e.__assign(e.__assign({},n.headers),{Authorization:process.env.AWS_CONTAINER_AUTHORIZATION_TOKEN})),[4,It(e.__assign(e.__assign({},n),{timeout:t}))];case 1:return[2,r.sent().toString()]}}))}))},zt={localhost:!0,"127.0.0.1":!0},jt={"http:":!0,"https:":!0},Mt=function(){return e.__awaiter(void 0,void 0,void 0,(function(){var n;return e.__generator(this,(function(r){if(process.env[Lt])return[2,{hostname:"169.254.170.2",path:process.env[Lt]}];if(process.env[Ot]){if(!(n=t.parse(process.env[Ot])).hostname||!(n.hostname in zt))throw new Te(n.hostname+" is not a valid container metadata service hostname",!1);if(!n.protocol||!(n.protocol in jt))throw new Te(n.protocol+" is not a valid container metadata service protocol",!1);return[2,e.__assign(e.__assign({},n),{port:n.port?parseInt(n.port,10):void 0})]}throw new Te("The container metadata credential provider cannot be used unless the "+Lt+" or "+Ot+" environment variable is set",!1)}))}))},Ht=function(){return{}},Ut=function(t){void 0===t&&(t={});var n=t.filepath,r=void 0===n?process.env.AWS_SHARED_CREDENTIALS_FILE||s.join(Vt(),".aws","credentials"):n,i=t.configFilepath,o=void 0===i?process.env.AWS_CONFIG_FILE||s.join(Vt(),".aws","config"):i;return Promise.all([Bt(o).then(Ft).then(Kt).catch(Ht),Bt(r).then(Ft).catch(Ht)]).then((function(t){var n=e.__read(t,2);return{configFile:n[0],credentialsFile:n[1]}}))},Wt=/^profile\s(["'])?([^\1]+)\1$/,Kt=function(t){var n,r,i={};try{for(var o=e.__values(Object.keys(t)),s=o.next();!s.done;s=o.next()){var a=s.value,u=void 0;if("default"===a)i.default=t.default;else if(u=Wt.exec(a)){var c=e.__read(u,3),d=(c[0],c[1],c[2]);d&&(i[d]=t[a])}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},$t=["__proto__","profile __proto__"],Ft=function(t){var n,r,i,o={};try{for(var s=e.__values(t.split(/\r?\n/)),a=s.next();!a.done;a=s.next()){var u=a.value,c=(u=u.split(/(^|\s)[;#]/)[0]).match(/^\s*\[([^\[\]]+)]\s*$/);if(c){if(i=c[1],$t.includes(i))throw new Error('Found invalid profile name "'+i+'"')}else if(i){var d=u.match(/^\s*(.+?)\s*=\s*(.+?)\s*$/);d&&(o[i]=o[i]||{},o[i][d[1]]=d[2])}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o},Bt=function(e){return new Promise((function(t,n){i.readFile(e,"utf8",(function(e,r){e?n(e):t(r)}))}))},Vt=function(){var e=process.env,t=e.HOME,n=e.USERPROFILE,r=e.HOMEPATH,i=e.HOMEDRIVE,a=void 0===i?"C:"+s.sep:i;return t||(n||(r?""+a+r:o.homedir()))},Gt=function(t){return"function"==typeof t?function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,t()]}))}))}:(n=t,function(){return Promise.resolve(n)});var n},Xt=function(t,n){var r,i=t.environmentVariableSelector,o=t.configFileSelector,s=t.default;return void 0===n&&(n={}),Ie(Re((r=i,function(){return e.__awaiter(void 0,void 0,void 0,(function(){var t;return e.__generator(this,(function(e){try{if(void 0===(t=r(process.env)))throw new Error;return[2,t]}catch(e){throw new Te(e.message||"Cannot load config from environment variables with getter: "+r)}return[2]}))}))}),function(t,n){void 0===n&&(n={});var r=n.preferredFile,i=void 0===r?"config":r,o=e.__rest(n,["preferredFile"]);return function(){return e.__awaiter(void 0,void 0,void 0,(function(){var n,r,s,a,u,c,d,l,f,v,g;return e.__generator(this,(function(_){switch(_.label){case 0:return n=o.loadedConfig,r=void 0===n?Ut(o):n,s=o.profile,a=void 0===s?process.env.AWS_PROFILE||"default":s,[4,r];case 1:u=_.sent(),c=u.configFile,d=u.credentialsFile,l=d[a]||{},f=c[a]||{},v="config"===i?e.__assign(e.__assign({},l),f):e.__assign(e.__assign({},f),l);try{if(void 0===(g=t(v)))throw new Error;return[2,g]}catch(e){throw new Te(e.message||"Cannot load config for profile "+a+" in SDK configuration files with getter: "+t)}return[2]}}))}))}}(o,n),Gt(s)))};var Yt,Jt=function(t){var n,r=new URL(t),i=r.hostname,o=r.pathname,s=r.port,a=r.protocol,u=r.search;return u&&(n=function(t){var n,r,i={};if(t=t.replace(/^\?/,""))try{for(var o=e.__values(t.split("&")),s=o.next();!s.done;s=o.next()){var a=s.value,u=e.__read(a.split("="),2),c=u[0],d=u[1],l=void 0===d?null:d;c=decodeURIComponent(c),l&&(l=decodeURIComponent(l)),c in i?Array.isArray(i[c])?i[c].push(l):i[c]=[i[c],l]:i[c]=l}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i}(u)),{hostname:i,port:s?parseInt(s):void 0,protocol:a,path:o,query:n}};!function(e){e.IPv4="http://169.254.169.254",e.IPv6="http://[fd00:ec2::254]"}(Yt||(Yt={}));var Zt,Qt={environmentVariableSelector:function(e){return e.AWS_EC2_METADATA_SERVICE_ENDPOINT},configFileSelector:function(e){return e.ec2_metadata_service_endpoint},default:void 0};!function(e){e.IPv4="IPv4",e.IPv6="IPv6"}(Zt||(Zt={}));var en={environmentVariableSelector:function(e){return e.AWS_EC2_METADATA_SERVICE_ENDPOINT_MODE},configFileSelector:function(e){return e.ec2_metadata_service_endpoint_mode},default:Zt.IPv4},tn=function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,Xt(Qt)()]}))}))},nn=function(){return e.__awaiter(void 0,void 0,void 0,(function(){var t;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,Xt(en)()];case 1:switch(t=e.sent()){case Zt.IPv4:return[2,Yt.IPv4];case Zt.IPv6:return[2,Yt.IPv6];default:throw new Error("Unsupported endpoint mode: "+t+". Select from "+Object.values(Zt))}}}))}))},rn="/latest/meta-data/iam/security-credentials/",on=function(t){void 0===t&&(t={});var n=!1,r=kt(t),i=r.timeout,o=r.maxRetries,s=function(t,r){return e.__awaiter(void 0,void 0,void 0,(function(){var i;return e.__generator(this,(function(o){switch(o.label){case 0:return[4,Nt((function(){return e.__awaiter(void 0,void 0,void 0,(function(){var t,i;return e.__generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,an(r)];case 1:return t=e.sent(),[3,3];case 2:throw 401===(i=e.sent()).statusCode&&(n=!1),i;case 3:return[2,t]}}))}))}),t)];case 1:return i=o.sent().trim(),[2,Nt((function(){return e.__awaiter(void 0,void 0,void 0,(function(){var t,o;return e.__generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,un(i,r)];case 1:return t=e.sent(),[3,3];case 2:throw 401===(o=e.sent()).statusCode&&(n=!1),o;case 3:return[2,t]}}))}))}),t)]}}))}))};return function(){return e.__awaiter(void 0,void 0,void 0,(function(){var t,r,a;return e.__generator(this,(function(u){switch(u.label){case 0:return[4,e.__awaiter(void 0,void 0,void 0,(function(){var t,n;return e.__generator(this,(function(e){switch(e.label){case 0:return t=Jt,[4,tn()];case 1:return(n=e.sent())?[3,3]:[4,nn()];case 2:n=e.sent(),e.label=3;case 3:return[2,t.apply(void 0,[n])]}}))}))];case 1:return t=u.sent(),n?[2,s(o,e.__assign(e.__assign({},t),{timeout:i}))]:[3,2];case 2:r=void 0,u.label=3;case 3:return u.trys.push([3,5,,6]),[4,sn(e.__assign(e.__assign({},t),{timeout:i}))];case 4:return r=u.sent().toString(),[3,6];case 5:if(400===(null==(a=u.sent())?void 0:a.statusCode))throw Object.assign(a,{message:"EC2 Metadata token request returned error"});return("TimeoutError"===a.message||[403,404,405].includes(a.statusCode))&&(n=!0),[2,s(o,e.__assign(e.__assign({},t),{timeout:i}))];case 6:return[2,s(o,e.__assign(e.__assign({},t),{headers:{"x-aws-ec2-metadata-token":r},timeout:i}))]}}))}))}},sn=function(t){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(n){return[2,It(e.__assign(e.__assign({},t),{path:"/latest/api/token",method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"21600"}}))]}))}))},an=function(t){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(n){switch(n.label){case 0:return[4,It(e.__assign(e.__assign({},t),{path:rn}))];case 1:return[2,n.sent().toString()]}}))}))},un=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i,o;return e.__generator(this,(function(s){switch(s.label){case 0:return o=(i=JSON).parse,[4,It(e.__assign(e.__assign({},n),{path:rn+t}))];case 1:if(r=o.apply(i,[s.sent().toString()]),!Ct(r))throw new Te("Invalid response received from instance metadata service.");return[2,Pt(r)]}}))}))},cn="3.30.0",dn=function(e,t,r){if(void 0===t&&(t=0),void 0===r&&(r=e.byteLength-t),!Xe(e))throw new TypeError('The "input" argument must be ArrayBuffer. Received type '+typeof e+" ("+e+")");return n.Buffer.from(e,t,r)},ln=function(e,t){if("string"!=typeof e)throw new TypeError('The "input" argument must be of type string. Received type '+typeof e+" ("+e+")");return t?n.Buffer.from(e,t):n.Buffer.from(e)},fn=function(){function e(e,t){this.hash=t?a.createHmac(e,vn(t)):a.createHash(e)}return e.prototype.update=function(e,t){this.hash.update(vn(e,t))},e.prototype.digest=function(){return Promise.resolve(this.hash.digest())},e}();function vn(e,t){return n.Buffer.isBuffer(e)?e:"string"==typeof e?ln(e,t):ArrayBuffer.isView(e)?dn(e.buffer,e.byteOffset,e.byteLength):dn(e)}var gn={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},_n=function(t){return{applyToStack:function(n){n.add(function(t){return function(n,r){return function(i){return e.__awaiter(void 0,void 0,void 0,(function(){var o;return e.__generator(this,(function(s){switch(s.label){case 0:return[4,t.retryStrategy()];case 1:return(null==(o=s.sent())?void 0:o.mode)&&(r.userAgent=e.__spreadArray(e.__spreadArray([],e.__read(r.userAgent||[]),!1),[["cfg/retry-mode",o.mode]],!1)),[2,o.retry(n,i)]}}))}))}}}(t),gn)}}},hn=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"],pn=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],mn=["AbortError","TimeoutError","RequestTimeout","RequestTimeoutException"],yn=[500,502,503,504],wn=function(e){var t,n;return 429===(null===(t=e.$metadata)||void 0===t?void 0:t.httpStatusCode)||pn.includes(e.name)||1==(null===(n=e.$retryable)||void 0===n?void 0:n.throttling)};const Sn=new Uint8Array(256);let bn=Sn.length;function An(){return bn>Sn.length-16&&(W.default.randomFillSync(Sn),bn=0),Sn.slice(bn,bn+=16)}var En=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const xn=[];for(let e=0;e<256;++e)xn.push((e+256).toString(16).substr(1));function Tn(e,t=0){const n=(xn[e[t+0]]+xn[e[t+1]]+xn[e[t+2]]+xn[e[t+3]]+"-"+xn[e[t+4]]+xn[e[t+5]]+"-"+xn[e[t+6]]+xn[e[t+7]]+"-"+xn[e[t+8]]+xn[e[t+9]]+"-"+xn[e[t+10]]+xn[e[t+11]]+xn[e[t+12]]+xn[e[t+13]]+xn[e[t+14]]+xn[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&En.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n}function Rn(e,t,n){const r=(e=e||{}).random||(e.rng||An)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return Tn(r)}var In;!function(e){e.STANDARD="standard",e.ADAPTIVE="adaptive"}(In||(In={}));var Cn=In.STANDARD,Pn=function(e,t){return Math.floor(Math.min(2e4,Math.random()*Math.pow(2,t)*e))},kn=function(e){return!!e&&(function(e){return void 0!==e.$retryable}(e)||function(e){return hn.includes(e.name)}(e)||wn(e)||function(e){var t;return mn.includes(e.name)||yn.includes((null===(t=e.$metadata)||void 0===t?void 0:t.httpStatusCode)||0)}(e))},Nn=function(){function t(e,t){var n,r,i;this.maxAttemptsProvider=e,this.mode=In.STANDARD,this.retryDecider=null!==(n=null==t?void 0:t.retryDecider)&&void 0!==n?n:kn,this.delayDecider=null!==(r=null==t?void 0:t.delayDecider)&&void 0!==r?r:Pn,this.retryQuota=null!==(i=null==t?void 0:t.retryQuota)&&void 0!==i?i:function(e,t){var n,r,i,o=e,s=null!==(n=null==t?void 0:t.noRetryIncrement)&&void 0!==n?n:1,a=null!==(r=null==t?void 0:t.retryCost)&&void 0!==r?r:5,u=null!==(i=null==t?void 0:t.timeoutRetryCost)&&void 0!==i?i:10,c=e,d=function(e){return"TimeoutError"===e.name?u:a},l=function(e){return d(e)<=c};return Object.freeze({hasRetryTokens:l,retrieveRetryTokens:function(e){if(!l(e))throw new Error("No retry token available");var t=d(e);return c-=t,t},releaseRetryTokens:function(e){c+=null!=e?e:s,c=Math.min(c,o)}})}(500)}return t.prototype.shouldRetry=function(e,t,n){return t<n&&this.retryDecider(e)&&this.retryQuota.hasRetryTokens(e)},t.prototype.getMaxAttempts=function(){return e.__awaiter(this,void 0,void 0,(function(){var t;return e.__generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.maxAttemptsProvider()];case 1:return t=e.sent(),[3,3];case 2:return e.sent(),t=3,[3,3];case 3:return[2,t]}}))}))},t.prototype.retry=function(t,n,r){return e.__awaiter(this,void 0,void 0,(function(){var i,o,s,a,u,c,d,l;return e.__generator(this,(function(f){switch(f.label){case 0:return o=0,s=0,[4,this.getMaxAttempts()];case 1:a=f.sent(),u=n.request,e.HttpRequest.isInstance(u)&&(u.headers["amz-sdk-invocation-id"]=Rn()),c=function(){var c,l,f,v,g,_;return e.__generator(this,(function(h){switch(h.label){case 0:return h.trys.push([0,4,,7]),e.HttpRequest.isInstance(u)&&(u.headers["amz-sdk-request"]="attempt="+(o+1)+"; max="+a),(null==r?void 0:r.beforeRequest)?[4,r.beforeRequest()]:[3,2];case 1:h.sent(),h.label=2;case 2:return[4,t(n)];case 3:return c=h.sent(),l=c.response,f=c.output,(null==r?void 0:r.afterRequest)&&r.afterRequest(l),d.retryQuota.releaseRetryTokens(i),f.$metadata.attempts=o+1,f.$metadata.totalRetryDelay=s,[2,{value:{response:l,output:f}}];case 4:return v=h.sent(),g=On(v),o++,d.shouldRetry(g,o,a)?(i=d.retryQuota.retrieveRetryTokens(g),_=d.delayDecider(wn(g)?500:100,o),s+=_,[4,new Promise((function(e){return setTimeout(e,_)}))]):[3,6];case 5:return h.sent(),[2,"continue"];case 6:throw g.$metadata||(g.$metadata={}),g.$metadata.attempts=o,g.$metadata.totalRetryDelay=s,g;case 7:return[2]}}))},d=this,f.label=2;case 2:return[5,c()];case 3:return"object"==typeof(l=f.sent())?[2,l.value]:[3,2];case 4:return[2]}}))}))},t}(),On=function(e){return e instanceof Error?e:e instanceof Object?Object.assign(new Error,e):"string"==typeof e?new Error(e):new Error("AWS SDK error wrapper for "+e)},Ln=function(){function t(e){var t,n,r,i,o;this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=null!==(t=null==e?void 0:e.beta)&&void 0!==t?t:.7,this.minCapacity=null!==(n=null==e?void 0:e.minCapacity)&&void 0!==n?n:1,this.minFillRate=null!==(r=null==e?void 0:e.minFillRate)&&void 0!==r?r:.5,this.scaleConstant=null!==(i=null==e?void 0:e.scaleConstant)&&void 0!==i?i:.4,this.smooth=null!==(o=null==e?void 0:e.smooth)&&void 0!==o?o:.8;var s=this.getCurrentTimeInSeconds();this.lastThrottleTime=s,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}return t.prototype.getCurrentTimeInSeconds=function(){return Date.now()/1e3},t.prototype.getSendToken=function(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,this.acquireTokenBucket(1)]}))}))},t.prototype.acquireTokenBucket=function(t){return e.__awaiter(this,void 0,void 0,(function(){var n;return e.__generator(this,(function(e){switch(e.label){case 0:return this.enabled?(this.refillTokenBucket(),t>this.currentCapacity?(n=(t-this.currentCapacity)/this.fillRate*1e3,[4,new Promise((function(e){return setTimeout(e,n)}))]):[3,2]):[2];case 1:e.sent(),e.label=2;case 2:return this.currentCapacity=this.currentCapacity-t,[2]}}))}))},t.prototype.refillTokenBucket=function(){var e=this.getCurrentTimeInSeconds();if(this.lastTimestamp){var t=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+t),this.lastTimestamp=e}else this.lastTimestamp=e},t.prototype.updateClientSendingRate=function(e){var t;if(this.updateMeasuredRate(),wn(e)){var n=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=n,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),t=this.cubicThrottle(n),this.enableTokenBucket()}else this.calculateTimeWindow(),t=this.cubicSuccess(this.getCurrentTimeInSeconds());var r=Math.min(t,2*this.measuredTxRate);this.updateTokenBucketRate(r)},t.prototype.calculateTimeWindow=function(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))},t.prototype.cubicThrottle=function(e){return this.getPrecise(e*this.beta)},t.prototype.cubicSuccess=function(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)},t.prototype.enableTokenBucket=function(){this.enabled=!0},t.prototype.updateTokenBucketRate=function(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)},t.prototype.updateMeasuredRate=function(){var e=this.getCurrentTimeInSeconds(),t=Math.floor(2*e)/2;if(this.requestCount++,t>this.lastTxRateBucket){var n=this.requestCount/(t-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(n*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=t}},t.prototype.getPrecise=function(e){return parseFloat(e.toFixed(8))},t}(),Dn=function(t){function n(n,r){var i=this,o=null!=r?r:{},s=o.rateLimiter,a=e.__rest(o,["rateLimiter"]);return(i=t.call(this,n,a)||this).rateLimiter=null!=s?s:new Ln,i.mode=In.ADAPTIVE,i}return e.__extends(n,t),n.prototype.retry=function(n,r){return e.__awaiter(this,void 0,void 0,(function(){var i=this;return e.__generator(this,(function(o){return[2,t.prototype.retry.call(this,n,r,{beforeRequest:function(){return e.__awaiter(i,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,this.rateLimiter.getSendToken()]}))}))},afterRequest:function(e){i.rateLimiter.updateClientSendingRate(e)}})]}))}))},n}(Nn),qn={environmentVariableSelector:function(e){var t=e.AWS_MAX_ATTEMPTS;if(t){var n=parseInt(t);if(Number.isNaN(n))throw new Error('Environment variable AWS_MAX_ATTEMPTS mast be a number, got "'+t+'"');return n}},configFileSelector:function(e){var t=e.max_attempts;if(t){var n=parseInt(t);if(Number.isNaN(n))throw new Error('Shared config file entry max_attempts mast be a number, got "'+t+'"');return n}},default:3},zn=function(t){var n=Mn(t.maxAttempts);return e.__assign(e.__assign({},t),{maxAttempts:n,retryStrategy:function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:return t.retryStrategy?[2,t.retryStrategy]:[4,jn(t.retryMode)];case 1:return e.sent()===In.ADAPTIVE?[2,new Dn(n)]:[2,new Nn(n)]}}))}))}})},jn=function(t){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:return"string"==typeof t?[2,t]:[4,t()];case 1:return[2,e.sent()]}}))}))},Mn=function(e){if(void 0===e&&(e=3),"number"==typeof e){var t=Promise.resolve(e);return function(){return t}}return e},Hn={environmentVariableSelector:function(e){return e.AWS_RETRY_MODE},configFileSelector:function(e){return e.retry_mode},default:Cn};var Un=["ECONNRESET","EPIPE","ETIMEDOUT"],Wn=function(t){var n,r,i={};try{for(var o=e.__values(Object.keys(t)),s=o.next();!s.done;s=o.next()){var a=s.value,u=t[a];i[a]=Array.isArray(u)?u.join(","):u}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i};function Kn(e,t){t instanceof c.Readable?t.pipe(e):t?e.end(Buffer.from(t)):e.end()}var $n=function(){function t(e){var t=void 0===e?{}:e,n=t.connectionTimeout,i=t.socketTimeout,o=t.httpAgent,s=t.httpsAgent;this.metadata={handlerProtocol:"http/1.1"},this.connectionTimeout=n,this.socketTimeout=i;this.httpAgent=o||new r.Agent({keepAlive:true,maxSockets:50}),this.httpsAgent=s||new u.Agent({keepAlive:true,maxSockets:50})}return t.prototype.destroy=function(){this.httpAgent.destroy(),this.httpsAgent.destroy()},t.prototype.handle=function(t,n){var i=this,o=(void 0===n?{}:n).abortSignal;return new Promise((function(n,s){if(null==o?void 0:o.aborted){var a=new Error("Request aborted");return a.name="AbortError",void s(a)}var c="https:"===t.protocol,d=function(t){var n,r,i=[];try{for(var o=e.__values(Object.keys(t).sort()),s=o.next();!s.done;s=o.next()){var a=s.value,u=t[a];if(a=Ve(a),Array.isArray(u))for(var c=0,d=u.length;c<d;c++)i.push(a+"="+Ve(u[c]));else{var l=a;(u||"string"==typeof u)&&(l+="="+Ve(u)),i.push(l)}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i.join("&")}(t.query||{}),l={headers:t.headers,host:t.hostname,method:t.method,path:d?t.path+"?"+d:t.path,port:t.port,agent:c?i.httpsAgent:i.httpAgent},f=(c?u.request:r.request)(l,(function(t){var r=new e.HttpResponse({statusCode:t.statusCode||-1,headers:Wn(t.headers),body:t});n({response:r})}));f.on("error",(function(e){Un.includes(e.code)?s(Object.assign(e,{name:"TimeoutError"})):s(e)})),function(e,t,n){void 0===n&&(n=0),n&&e.on("socket",(function(r){if(r.connecting){var i=setTimeout((function(){e.destroy(),t(Object.assign(new Error("Socket timed out without establishing a connection within "+n+" ms"),{name:"TimeoutError"}))}),n);r.on("connect",(function(){clearTimeout(i)}))}}))}(f,s,i.connectionTimeout),function(e,t,n){void 0===n&&(n=0),e.setTimeout(n,(function(){e.destroy(),t(Object.assign(new Error("Connection timed out after "+n+" ms"),{name:"TimeoutError"}))}))}(f,s,i.socketTimeout),o&&(o.onabort=function(){f.abort();var e=new Error("Request aborted");e.name="AbortError",s(e)}),function(e,t){"100-continue"===(t.headers.Expect||t.headers.expect)?e.on("continue",(function(){Kn(e,t.body)})):Kn(e,t.body)}(f,t)}))},t}(),Fn=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.bufferedBytes=[],e}return e.__extends(n,t),n.prototype._write=function(e,t,n){this.bufferedBytes.push(e),n()},n}(c.Writable),Bn=function(e){return new Promise((function(t,n){var r=new Fn;e.pipe(r),e.on("error",(function(e){r.end(),n(e)})),r.on("error",n),r.on("finish",(function(){var e=new Uint8Array(Buffer.concat(this.bufferedBytes));t(e)}))}))};function Vn(e){var t=ln(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function Gn(e){return dn(e.buffer,e.byteOffset,e.byteLength).toString("base64")}function Xn(e){return e?"string"==typeof e?Buffer.from(e).length:"number"==typeof e.byteLength?e.byteLength:"number"==typeof e.size?e.size:"string"==typeof e.path?i.lstatSync(e.path).size:void 0:0}var Yn=function(t){var n=t.serviceId,r=t.clientVersion,i=[["aws-sdk-js",r],["os/"+o.platform(),o.release()],["lang/js"],["md/nodejs",""+d.versions.node]];n&&i.push(["api/"+n,r]),d.env.AWS_EXECUTION_ENV&&i.push(["exec-env/"+d.env.AWS_EXECUTION_ENV]);var s=Xt({environmentVariableSelector:function(e){return e.AWS_SDK_UA_APP_ID},configFileSelector:function(e){return e["sdk-ua-app-id"]},default:void 0})(),a=void 0;return function(){return e.__awaiter(void 0,void 0,void 0,(function(){var t;return e.__generator(this,(function(n){switch(n.label){case 0:return a?[3,2]:[4,s];case 1:t=n.sent(),a=t?e.__spreadArray(e.__spreadArray([],e.__read(i),!1),[["app/"+t]],!1):e.__spreadArray([],e.__read(i),!1),n.label=2;case 2:return[2,a]}}))}))}},Jn=function(e){var t=ln(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT)},Zn=function(e){return dn(e.buffer,e.byteOffset,e.byteLength).toString("utf8")},Qn={"ap-southeast-1":{hostname:"portal.sso.ap-southeast-1.amazonaws.com",signingRegion:"ap-southeast-1"},"ap-southeast-2":{hostname:"portal.sso.ap-southeast-2.amazonaws.com",signingRegion:"ap-southeast-2"},"ca-central-1":{hostname:"portal.sso.ca-central-1.amazonaws.com",signingRegion:"ca-central-1"},"eu-central-1":{hostname:"portal.sso.eu-central-1.amazonaws.com",signingRegion:"eu-central-1"},"eu-west-1":{hostname:"portal.sso.eu-west-1.amazonaws.com",signingRegion:"eu-west-1"},"eu-west-2":{hostname:"portal.sso.eu-west-2.amazonaws.com",signingRegion:"eu-west-2"},"us-east-1":{hostname:"portal.sso.us-east-1.amazonaws.com",signingRegion:"us-east-1"},"us-east-2":{hostname:"portal.sso.us-east-2.amazonaws.com",signingRegion:"us-east-2"},"us-west-2":{hostname:"portal.sso.us-west-2.amazonaws.com",signingRegion:"us-west-2"}},er={aws:{regions:["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","eu-central-1","eu-north-1","eu-south-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-west-1","us-west-2"],hostname:"portal.sso.{region}.amazonaws.com"},"aws-cn":{regions:["cn-north-1","cn-northwest-1"],hostname:"portal.sso.{region}.amazonaws.com.cn"},"aws-iso":{regions:["us-iso-east-1"],hostname:"portal.sso.{region}.c2s.ic.gov"},"aws-iso-b":{regions:["us-isob-east-1"],hostname:"portal.sso.{region}.sc2s.sgov.gov"},"aws-us-gov":{regions:["us-gov-east-1","us-gov-west-1"],hostname:"portal.sso.{region}.amazonaws.com"}},tr=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(r){return[2,Tt(t,e.__assign(e.__assign({},n),{signingService:"awsssoportal",regionHash:Qn,partitionHash:er}))]}))}))},nr=function(t){var n,r,i,o,s,a,u,c,d,l,f,v;F(process.version);var g=function(e){var t,n,r,i,o;return{apiVersion:"2019-06-10",disableHostPrefix:null!==(t=null==e?void 0:e.disableHostPrefix)&&void 0!==t&&t,logger:null!==(n=null==e?void 0:e.logger)&&void 0!==n?n:{},regionInfoProvider:null!==(r=null==e?void 0:e.regionInfoProvider)&&void 0!==r?r:tr,serviceId:null!==(i=null==e?void 0:e.serviceId)&&void 0!==i?i:"SSO",urlParser:null!==(o=null==e?void 0:e.urlParser)&&void 0!==o?o:Jt}}(t);return e.__assign(e.__assign(e.__assign({},g),t),{runtime:"node",base64Decoder:null!==(n=null==t?void 0:t.base64Decoder)&&void 0!==n?n:Vn,base64Encoder:null!==(r=null==t?void 0:t.base64Encoder)&&void 0!==r?r:Gn,bodyLengthChecker:null!==(i=null==t?void 0:t.bodyLengthChecker)&&void 0!==i?i:Xn,defaultUserAgentProvider:null!==(o=null==t?void 0:t.defaultUserAgentProvider)&&void 0!==o?o:Yn({serviceId:g.serviceId,clientVersion:cn}),maxAttempts:null!==(s=null==t?void 0:t.maxAttempts)&&void 0!==s?s:Xt(qn),region:null!==(a=null==t?void 0:t.region)&&void 0!==a?a:Xt(wt,St),requestHandler:null!==(u=null==t?void 0:t.requestHandler)&&void 0!==u?u:new $n,retryMode:null!==(c=null==t?void 0:t.retryMode)&&void 0!==c?c:Xt(Hn),sha256:null!==(d=null==t?void 0:t.sha256)&&void 0!==d?d:fn.bind(null,"sha256"),streamCollector:null!==(l=null==t?void 0:t.streamCollector)&&void 0!==l?l:Bn,utf8Decoder:null!==(f=null==t?void 0:t.utf8Decoder)&&void 0!==f?f:Jn,utf8Encoder:null!==(v=null==t?void 0:t.utf8Encoder)&&void 0!==v?v:Zn})};var rr={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},ir=function(t){return{applyToStack:function(n){n.add(function(t){var n=this;return function(r){return function(i){return e.__awaiter(n,void 0,void 0,(function(){var n,o,s,a,u;return e.__generator(this,(function(c){return n=i.request,e.HttpRequest.isInstance(n)&&(o=n.body,s=n.headers,o&&-1===Object.keys(s).map((function(e){return e.toLowerCase()})).indexOf("content-length")&&void 0!==(a=t(o))&&(n.headers=e.__assign(e.__assign({},n.headers),((u={})["content-length"]=String(a),u)))),[2,r(e.__assign(e.__assign({},i),{request:n}))]}))}))}}}(t.bodyLengthChecker),rr)}}};function or(e){return e}var sr={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},ar=function(t){return{applyToStack:function(n){n.add(function(t){return function(n){return function(r){return e.__awaiter(void 0,void 0,void 0,(function(){var i,o;return e.__generator(this,(function(s){return e.HttpRequest.isInstance(r.request)?(i=r.request,(void 0===(o=(t.requestHandler.metadata||{}).handlerProtocol)?"":o).indexOf("h2")>=0&&!i.headers[":authority"]?(delete i.headers.host,i.headers[":authority"]=""):i.headers.host||(i.headers.host=i.hostname),[2,n(r)]):[2,n(r)]}))}))}}}(t),sr)}}},ur={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},cr=function(t){return{applyToStack:function(t){t.add((function(t,n){return function(r){return e.__awaiter(void 0,void 0,void 0,(function(){var i,o,s,a,u,c,d,l,f;return e.__generator(this,(function(v){switch(v.label){case 0:return i=n.clientName,o=n.commandName,s=n.inputFilterSensitiveLog,a=n.logger,u=n.outputFilterSensitiveLog,[4,t(r)];case 1:return c=v.sent(),a?("function"==typeof a.info&&(d=c.output,l=d.$metadata,f=e.__rest(d,["$metadata"]),a.info({clientName:i,commandName:o,input:s(r.input),output:u(f),metadata:l})),[2,c]):[2,c]}}))}))}}),ur)}}};function dr(t){return e.__assign(e.__assign({},t),{customUserAgent:"string"==typeof t.customUserAgent?[[t.customUserAgent]]:t.customUserAgent})}var lr,fr,vr,gr,_r,hr,pr,mr,yr,wr,Sr,br,Ar,Er,xr=/[^\!\#\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,Tr=function(t){var n=e.__read(t,2),r=n[0],i=n[1],o=r.indexOf("/"),s=r.substring(0,o),a=r.substring(o+1);return"api"===s&&(a=a.toLowerCase()),[s,a,i].filter((function(e){return e&&e.length>0})).map((function(e){return null==e?void 0:e.replace(xr,"_")})).join("/")},Rr={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},Ir=function(t){return{applyToStack:function(n){var r;n.add((r=t,function(t,n){return function(i){return e.__awaiter(void 0,void 0,void 0,(function(){var o,s,a,u,c,d,l,f,v;return e.__generator(this,(function(g){switch(g.label){case 0:return o=i.request,e.HttpRequest.isInstance(o)?(s=o.headers,a=(null===(f=null==n?void 0:n.userAgent)||void 0===f?void 0:f.map(Tr))||[],[4,r.defaultUserAgentProvider()]):[2,t(i)];case 1:return u=g.sent().map(Tr),c=(null===(v=null==r?void 0:r.customUserAgent)||void 0===v?void 0:v.map(Tr))||[],d=e.__spreadArray(e.__spreadArray(e.__spreadArray([],e.__read(u),!1),e.__read(a),!1),e.__read(c),!1).join(" "),l=e.__spreadArray(e.__spreadArray([],e.__read(u.filter((function(e){return e.startsWith("aws-sdk-")}))),!1),e.__read(c),!1).join(" "),"browser"!==r.runtime?(l&&(s["x-amz-user-agent"]=s["x-amz-user-agent"]?s["user-agent"]+" "+l:l),s["user-agent"]=d):s["x-amz-user-agent"]=d,[2,t(e.__assign(e.__assign({},i),{request:o}))]}}))}))}}),Rr)}}},Cr=function(t){function n(e){var n=this,r=nr(e),i=At(r),o=yt(i),s=dr(zn(o));return(n=t.call(this,s)||this).config=s,n.middlewareStack.use(_n(n.config)),n.middlewareStack.use(ir(n.config)),n.middlewareStack.use(ar(n.config)),n.middlewareStack.use(cr(n.config)),n.middlewareStack.use(Ir(n.config)),n}return e.__extends(n,t),n.prototype.destroy=function(){t.prototype.destroy.call(this)},n}(e.Client);!function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(lr||(lr={})),function(t){t.filterSensitiveLog=function(t){return e.__assign(e.__assign({},t),t.accessToken&&{accessToken:e.SENSITIVE_STRING})}}(fr||(fr={})),function(t){t.filterSensitiveLog=function(t){return e.__assign(e.__assign(e.__assign({},t),t.secretAccessKey&&{secretAccessKey:e.SENSITIVE_STRING}),t.sessionToken&&{sessionToken:e.SENSITIVE_STRING})}}(vr||(vr={})),function(t){t.filterSensitiveLog=function(t){return e.__assign(e.__assign({},t),t.roleCredentials&&{roleCredentials:vr.filterSensitiveLog(t.roleCredentials)})}}(gr||(gr={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(_r||(_r={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(hr||(hr={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(pr||(pr={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(mr||(mr={})),function(t){t.filterSensitiveLog=function(t){return e.__assign(e.__assign({},t),t.accessToken&&{accessToken:e.SENSITIVE_STRING})}}(yr||(yr={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(wr||(wr={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(Sr||(Sr={})),function(t){t.filterSensitiveLog=function(t){return e.__assign(e.__assign({},t),t.accessToken&&{accessToken:e.SENSITIVE_STRING})}}(br||(br={})),function(t){t.filterSensitiveLog=function(t){return e.__assign({},t)}}(Ar||(Ar={})),function(t){t.filterSensitiveLog=function(t){return e.__assign(e.__assign({},t),t.accessToken&&{accessToken:e.SENSITIVE_STRING})}}(Er||(Er={}));var Pr=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i,o,s,a,u,c,d,l,f,v;return e.__generator(this,(function(g){switch(g.label){case 0:return i=[e.__assign({},t)],v={},[4,Mr(t.body,n)];case 1:switch(r=e.__assign.apply(void 0,i.concat([(v.body=g.sent(),v)])),s="UnknownError",s=Hr(t,r.body),s){case"InvalidRequestException":case"com.amazonaws.sso#InvalidRequestException":return[3,2];case"ResourceNotFoundException":case"com.amazonaws.sso#ResourceNotFoundException":return[3,4];case"TooManyRequestsException":case"com.amazonaws.sso#TooManyRequestsException":return[3,6];case"UnauthorizedException":case"com.amazonaws.sso#UnauthorizedException":return[3,8]}return[3,10];case 2:return a=[{}],[4,kr(r,n)];case 3:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,a.concat([g.sent()])),{name:s,$metadata:qr(t)}]),[3,11];case 4:return u=[{}],[4,Nr(r,n)];case 5:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,u.concat([g.sent()])),{name:s,$metadata:qr(t)}]),[3,11];case 6:return c=[{}],[4,Or(r,n)];case 7:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,c.concat([g.sent()])),{name:s,$metadata:qr(t)}]),[3,11];case 8:return d=[{}],[4,Lr(r,n)];case 9:return o=e.__assign.apply(void 0,[e.__assign.apply(void 0,d.concat([g.sent()])),{name:s,$metadata:qr(t)}]),[3,11];case 10:l=r.body,s=l.code||l.Code||s,o=e.__assign(e.__assign({},l),{name:""+s,message:l.message||l.Message||s,$fault:"client",$metadata:qr(t)}),g.label=11;case 11:return f=o.message||o.Message||s,o.message=f,delete o.Message,[2,Promise.reject(Object.assign(new Error(f),o))]}}))}))},kr=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var n,r;return e.__generator(this,(function(i){return n={name:"InvalidRequestException",$fault:"client",$metadata:qr(t),message:void 0},void 0!==(r=t.body).message&&null!==r.message&&(n.message=e.expectString(r.message)),[2,n]}))}))},Nr=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var n,r;return e.__generator(this,(function(i){return n={name:"ResourceNotFoundException",$fault:"client",$metadata:qr(t),message:void 0},void 0!==(r=t.body).message&&null!==r.message&&(n.message=e.expectString(r.message)),[2,n]}))}))},Or=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var n,r;return e.__generator(this,(function(i){return n={name:"TooManyRequestsException",$fault:"client",$metadata:qr(t),message:void 0},void 0!==(r=t.body).message&&null!==r.message&&(n.message=e.expectString(r.message)),[2,n]}))}))},Lr=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var n,r;return e.__generator(this,(function(i){return n={name:"UnauthorizedException",$fault:"client",$metadata:qr(t),message:void 0},void 0!==(r=t.body).message&&null!==r.message&&(n.message=e.expectString(r.message)),[2,n]}))}))},Dr=function(t,n){return{accessKeyId:e.expectString(t.accessKeyId),expiration:e.expectLong(t.expiration),secretAccessKey:e.expectString(t.secretAccessKey),sessionToken:e.expectString(t.sessionToken)}},qr=function(e){var t;return{httpStatusCode:e.statusCode,requestId:null!==(t=e.headers["x-amzn-requestid"])&&void 0!==t?t:e.headers["x-amzn-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}},zr=function(e,t){return function(e,t){return void 0===e&&(e=new Uint8Array),e instanceof Uint8Array?Promise.resolve(e):t.streamCollector(e)||Promise.resolve(new Uint8Array)}(e,t).then((function(e){return t.utf8Encoder(e)}))},jr=function(e){return!(null==e||""===e||Object.getOwnPropertyNames(e).includes("length")&&0==e.length||Object.getOwnPropertyNames(e).includes("size")&&0==e.size)},Mr=function(e,t){return zr(e,t).then((function(e){return e.length?JSON.parse(e):{}}))},Hr=function(e,t){var n,r,i=function(e){var t=e;return t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},o=(n=e.headers,r="x-amzn-errortype",Object.keys(n).find((function(e){return e.toLowerCase()===r.toLowerCase()})));return void 0!==o?i(e.headers[o]):void 0!==t.code?i(t.code):void 0!==t.__type?i(t.__type):""},Ur=function(t){function n(e){var n=t.call(this)||this;return n.input=e,n}return e.__extends(n,t),n.prototype.resolveMiddleware=function(t,n,r){this.middlewareStack.use(e.getSerdePlugin(n,this.serialize,this.deserialize));var i=t.concat(this.middlewareStack),o={logger:n.logger,clientName:"SSOClient",commandName:"GetRoleCredentialsCommand",inputFilterSensitiveLog:fr.filterSensitiveLog,outputFilterSensitiveLog:gr.filterSensitiveLog},s=n.requestHandler;return i.resolve((function(e){return s.handle(e.request,r||{})}),o)},n.prototype.serialize=function(t,n){return function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i,o,s,a,u,c,d,l;return e.__generator(this,(function(f){switch(f.label){case 0:return[4,n.endpoint()];case 1:return r=f.sent(),i=r.hostname,o=r.protocol,s=void 0===o?"https":o,a=r.port,u=r.path,c=e.__assign({},jr(t.accessToken)&&{"x-amz-sso_bearer_token":t.accessToken}),d=((null==u?void 0:u.endsWith("/"))?u.slice(0,-1):u||"")+"/federation/credentials",l=e.__assign(e.__assign({},void 0!==t.roleName&&{role_name:t.roleName}),void 0!==t.accountId&&{account_id:t.accountId}),[2,new e.HttpRequest({protocol:s,hostname:i,port:a,method:"GET",headers:c,path:d,query:l,body:void 0})]}}))}))}(t,n)},n.prototype.deserialize=function(t,n){return function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i,o,s;return e.__generator(this,(function(a){switch(a.label){case 0:return 200!==t.statusCode&&t.statusCode>=300?[2,Pr(t,n)]:(r={$metadata:qr(t),roleCredentials:void 0},o=e.expectNonNull,s=e.expectObject,[4,Mr(t.body,n)]);case 1:return void 0!==(i=o.apply(void 0,[s.apply(void 0,[a.sent()]),"body"])).roleCredentials&&null!==i.roleCredentials&&(r.roleCredentials=Dr(i.roleCredentials,n)),[2,Promise.resolve(r)]}}))}))}(t,n)},n}(e.Command),Wr=function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var n,r;return e.__generator(this,(function(i){switch(i.label){case 0:return n=t.loadedConfig,[4,void 0===n?Ut(t):n];case 1:return r=i.sent(),[2,e.__assign(e.__assign({},r.configFile),r.credentialsFile)]}}))}))},Kr=function(e){return e.profile||process.env.AWS_PROFILE||"default"},$r=function(t){return void 0===t&&(t={}),function(){return e.__awaiter(void 0,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,d,l,f,v,g;return e.__generator(this,(function(e){switch(e.label){case 0:return n=t.ssoStartUrl,r=t.ssoAccountId,i=t.ssoRegion,o=t.ssoRoleName,s=t.ssoClient,n||r||i||o?[3,2]:[4,Wr(t)];case 1:if(a=e.sent(),u=Kr(t),c=a[u],!Vr(c))throw new Te("Profile "+u+" is not configured with SSO credentials.");return d=Br(c),l=d.sso_start_url,f=d.sso_account_id,v=d.sso_region,g=d.sso_role_name,[2,Fr({ssoStartUrl:l,ssoAccountId:f,ssoRegion:v,ssoRoleName:g,ssoClient:s})];case 2:if(n&&r&&i&&o)return[2,Fr({ssoStartUrl:n,ssoAccountId:r,ssoRegion:i,ssoRoleName:o,ssoClient:s})];throw new Te('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"');case 3:return[2]}}))}))}},Fr=function(t){var n=t.ssoStartUrl,r=t.ssoAccountId,o=t.ssoRegion,u=t.ssoRoleName,c=t.ssoClient;return e.__awaiter(void 0,void 0,void 0,(function(){var t,d,l,f,v,g,_,h,p,m,y,w,S,b;return e.__generator(this,(function(e){switch(e.label){case 0:t=a.createHash("sha1"),d=t.update(n).digest("hex"),l=s.join(Vt(),".aws","sso","cache",d+".json");try{if(f=JSON.parse(i.readFileSync(l,{encoding:"utf-8"})),new Date(f.expiresAt).getTime()-Date.now()<=9e5)throw new Error("SSO token is expired.")}catch(e){throw new Te("The SSO session associated with this profile has expired or is otherwise invalid. To refresh this SSO session run aws sso login with the corresponding profile.",false)}v=f.accessToken,g=c||new Cr({region:o}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,g.send(new Ur({accountId:r,roleName:u,accessToken:v}))];case 2:return _=e.sent(),[3,4];case 3:throw h=e.sent(),Te.from(h,false);case 4:if(p=_.roleCredentials,y=(m=void 0===p?{}:p).accessKeyId,w=m.secretAccessKey,S=m.sessionToken,b=m.expiration,!(y&&w&&S&&b))throw new Te("SSO returns an invalid temporary credential.",false);return[2,{accessKeyId:y,secretAccessKey:w,sessionToken:S,expiration:new Date(b)}]}}))}))},Br=function(e){var t=e.sso_start_url,n=e.sso_account_id,r=e.sso_region,i=e.sso_role_name;if(!(t&&n&&r&&i))throw new Te('Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got '+Object.keys(e).join(", ")+"\nReference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html",false);return e},Vr=function(e){return e&&("string"==typeof e.sso_start_url||"string"==typeof e.sso_account_id||"string"==typeof e.sso_region||"string"==typeof e.sso_role_name)},Gr=function(t){return void 0===t&&(t={}),function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,Xr(t)]}))}))}},Xr=function(t){var n,r,o,s=null!==(n=null==t?void 0:t.webIdentityTokenFile)&&void 0!==n?n:process.env.AWS_WEB_IDENTITY_TOKEN_FILE,a=null!==(r=null==t?void 0:t.roleArn)&&void 0!==r?r:process.env.AWS_ROLE_ARN,u=null!==(o=null==t?void 0:t.roleSessionName)&&void 0!==o?o:process.env.AWS_ROLE_SESSION_NAME;if(!s||!a)throw new Te("Web identity configuration not specified");return function(e){return function(){var t=e.roleArn,n=e.roleSessionName,r=e.webIdentityToken,i=e.providerId,o=e.policyArns,s=e.policy,a=e.durationSeconds,u=e.roleAssumerWithWebIdentity;if(!u)throw new Te("Role Arn '"+t+"' needs to be assumed with web identity, but no role assumption callback was provided.",!1);return u({RoleArn:t,RoleSessionName:null!=n?n:"aws-sdk-js-session-"+Date.now(),WebIdentityToken:r,ProviderId:i,PolicyArns:o,Policy:s,DurationSeconds:a})}}(e.__assign(e.__assign({},t),{webIdentityToken:i.readFileSync(s,{encoding:"ascii"}),roleArn:a,roleSessionName:u}))()},Yr=function(e){return Boolean(e)&&"object"==typeof e&&"string"==typeof e.aws_access_key_id&&"string"==typeof e.aws_secret_access_key&&["undefined","string"].indexOf(typeof e.aws_session_token)>-1},Jr=function(e){return Boolean(e)&&"object"==typeof e&&"string"==typeof e.role_arn&&["undefined","string"].indexOf(typeof e.role_session_name)>-1&&["undefined","string"].indexOf(typeof e.external_id)>-1&&["undefined","string"].indexOf(typeof e.mfa_serial)>-1},Zr=function(t){return void 0===t&&(t={}),function(){return e.__awaiter(void 0,void 0,void 0,(function(){var n;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,Wr(t)];case 1:return n=e.sent(),[2,Qr(Kr(t),n,t)]}}))}))}},Qr=function(t,n,r,i){return void 0===i&&(i={}),e.__awaiter(void 0,void 0,void 0,(function(){var o,s,a,u,c,d,l,f,v,g,_,h,p,m,y,w,S,b,A;return e.__generator(this,(function(E){switch(E.label){case 0:if(o=n[t],Object.keys(i).length>0&&Yr(o))return[2,ti(o)];if(!(Jr(x=o)&&"string"==typeof x.source_profile&&void 0===x.credential_source||function(e){return Jr(e)&&"string"==typeof e.credential_source&&void 0===e.source_profile}(o)))return[3,4];if(s=o.external_id,a=o.mfa_serial,u=o.role_arn,c=o.role_session_name,d=void 0===c?"aws-sdk-js-"+Date.now():c,l=o.source_profile,f=o.credential_source,!r.roleAssumer)throw new Te("Profile "+t+" requires a role to be assumed, but no role assumption callback was provided.",!1);if(l&&l in i)throw new Te("Detected a cycle attempting to resolve credentials for profile "+Kr(r)+". Profiles visited: "+Object.keys(i).join(", "),!1);if(v=l?Qr(l,n,r,e.__assign(e.__assign({},i),((A={})[l]=!0,A))):ei(f,t)(),g={RoleArn:u,RoleSessionName:d,ExternalId:s},!a)return[3,2];if(!r.mfaCodeProvider)throw new Te("Profile "+t+" requires multi-factor authentication, but no MFA code callback was provided.",!1);return g.SerialNumber=a,_=g,[4,r.mfaCodeProvider(a)];case 1:_.TokenCode=E.sent(),E.label=2;case 2:return p=(h=r).roleAssumer,[4,v];case 3:return[2,p.apply(h,[E.sent(),g])];case 4:if(Yr(o))return[2,ti(o)];if(function(e){return Boolean(e)&&"object"==typeof e&&"string"==typeof e.web_identity_token_file&&"string"==typeof e.role_arn&&["undefined","string"].indexOf(typeof e.role_session_name)>-1}(o))return[2,ni(o,r)];if(Vr(o))return m=Br(o),y=m.sso_start_url,w=m.sso_account_id,S=m.sso_region,b=m.sso_role_name,[2,$r({ssoStartUrl:y,ssoAccountId:w,ssoRegion:S,ssoRoleName:b})()];throw new Te("Profile "+t+" could not be found or parsed in shared credentials file.")}var x}))}))},ei=function(e,t){var n={EcsContainer:Dt,Ec2InstanceMetadata:on,Environment:Rt};if(e in n)return n[e]();throw new Te("Unsupported credential source in profile "+t+". Got "+e+", expected EcsContainer or Ec2InstanceMetadata or Environment.")},ti=function(e){return Promise.resolve({accessKeyId:e.aws_access_key_id,secretAccessKey:e.aws_secret_access_key,sessionToken:e.aws_session_token})},ni=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,Gr({webIdentityTokenFile:t.web_identity_token_file,roleArn:t.role_arn,roleSessionName:t.role_session_name,roleAssumerWithWebIdentity:n.roleAssumerWithWebIdentity})()]}))}))},ri=function(t){return void 0===t&&(t={}),function(){return e.__awaiter(void 0,void 0,void 0,(function(){var n;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,Wr(t)];case 1:return n=e.sent(),[2,ii(Kr(t),n)]}}))}))}},ii=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){var r,i;return e.__generator(this,(function(e){switch(e.label){case 0:return r=n[t],n[t]?void 0===(i=r.credential_process)?[3,2]:[4,oi(i).then((function(e){var n;try{n=JSON.parse(e)}catch(e){throw Error("Profile "+t+" credential_process returned invalid JSON.")}var r,i=n.Version,o=n.AccessKeyId,s=n.SecretAccessKey,a=n.SessionToken,u=n.Expiration;if(1!==i)throw Error("Profile "+t+" credential_process did not return Version 1.");if(void 0===o||void 0===s)throw Error("Profile "+t+" credential_process returned invalid credentials.");if(u){var c=new Date;if(new Date(u)<c)throw Error("Profile "+t+" credential_process returned expired credentials.");r=Math.floor(new Date(u).valueOf()/1e3)}return{accessKeyId:o,secretAccessKey:s,sessionToken:a,expirationUnix:r}})).catch((function(e){throw new Te(e.message)}))]:[3,4];case 1:return[2,e.sent()];case 2:throw new Te("Profile "+t+" did not contain credential_process.");case 3:return[3,5];case 4:throw new Te("Profile "+t+" could not be found in shared credentials file.");case 5:return[2]}}))}))},oi=function(e){return new Promise((function(t,n){l.exec(e,(function(e,r){e?n(e):t(r.trim())}))}))},si=function(t){void 0===t&&(t={});var n=e.__assign({profile:process.env.AWS_PROFILE},t);n.loadedConfig||(n.loadedConfig=Ut(t));var r=[$r(n),Zr(n),ri(n),Gr(n),ai(n),function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){throw new Te("Could not load credentials from any providers",!1)}))}))}];n.profile||r.unshift(Rt());var i=Re.apply(void 0,e.__spreadArray([],e.__read(r),!1));return Ie(i,(function(e){return void 0!==e.expiration&&e.expiration.getTime()-Date.now()<3e5}),(function(e){return void 0!==e.expiration}))},ai=function(e){return process.env[Lt]||process.env[Ot]?Dt(e):process.env.AWS_EC2_METADATA_DISABLED?function(){return Promise.reject(new Te("EC2 Instance Metadata Service access disabled"))}:on(e)},ui={"aws-global":{hostname:"sts.amazonaws.com",signingRegion:"us-east-1"},"us-east-1-fips":{hostname:"sts-fips.us-east-1.amazonaws.com",signingRegion:"us-east-1"},"us-east-2-fips":{hostname:"sts-fips.us-east-2.amazonaws.com",signingRegion:"us-east-2"},"us-gov-east-1-fips":{hostname:"sts.us-gov-east-1.amazonaws.com",signingRegion:"us-gov-east-1"},"us-gov-west-1-fips":{hostname:"sts.us-gov-west-1.amazonaws.com",signingRegion:"us-gov-west-1"},"us-west-1-fips":{hostname:"sts-fips.us-west-1.amazonaws.com",signingRegion:"us-west-1"},"us-west-2-fips":{hostname:"sts-fips.us-west-2.amazonaws.com",signingRegion:"us-west-2"}},ci={aws:{regions:["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","aws-global","ca-central-1","eu-central-1","eu-north-1","eu-south-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-1-fips","us-east-2","us-east-2-fips","us-west-1","us-west-1-fips","us-west-2","us-west-2-fips"],hostname:"sts.{region}.amazonaws.com"},"aws-cn":{regions:["cn-north-1","cn-northwest-1"],hostname:"sts.{region}.amazonaws.com.cn"},"aws-iso":{regions:["us-iso-east-1"],hostname:"sts.{region}.c2s.ic.gov"},"aws-iso-b":{regions:["us-isob-east-1"],hostname:"sts.{region}.sc2s.sgov.gov"},"aws-us-gov":{regions:["us-gov-east-1","us-gov-east-1-fips","us-gov-west-1","us-gov-west-1-fips"],hostname:"sts.{region}.amazonaws.com"}},di=function(t,n){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(r){return[2,Tt(t,e.__assign(e.__assign({},n),{signingService:"sts",regionHash:ui,partitionHash:ci}))]}))}))},li=function(t){var n,r,i,o,s,a,u,c,d,l,f,v,g;F(process.version);var _,h=function(e){var t,n,r,i,o;return{apiVersion:"2011-06-15",disableHostPrefix:null!==(t=null==e?void 0:e.disableHostPrefix)&&void 0!==t&&t,logger:null!==(n=null==e?void 0:e.logger)&&void 0!==n?n:{},regionInfoProvider:null!==(r=null==e?void 0:e.regionInfoProvider)&&void 0!==r?r:di,serviceId:null!==(i=null==e?void 0:e.serviceId)&&void 0!==i?i:"STS",urlParser:null!==(o=null==e?void 0:e.urlParser)&&void 0!==o?o:Jt}}(t);return e.__assign(e.__assign(e.__assign({},h),t),{runtime:"node",base64Decoder:null!==(n=null==t?void 0:t.base64Decoder)&&void 0!==n?n:Vn,base64Encoder:null!==(r=null==t?void 0:t.base64Encoder)&&void 0!==r?r:Gn,bodyLengthChecker:null!==(i=null==t?void 0:t.bodyLengthChecker)&&void 0!==i?i:Xn,credentialDefaultProvider:null!==(o=null==t?void 0:t.credentialDefaultProvider)&&void 0!==o?o:(_=si,function(t){return _(e.__assign({roleAssumer:ht(t,t.stsClientCtor),roleAssumerWithWebIdentity:pt(t,t.stsClientCtor)},t))}),defaultUserAgentProvider:null!==(s=null==t?void 0:t.defaultUserAgentProvider)&&void 0!==s?s:Yn({serviceId:h.serviceId,clientVersion:K}),maxAttempts:null!==(a=null==t?void 0:t.maxAttempts)&&void 0!==a?a:Xt(qn),region:null!==(u=null==t?void 0:t.region)&&void 0!==u?u:Xt(wt,St),requestHandler:null!==(c=null==t?void 0:t.requestHandler)&&void 0!==c?c:new $n,retryMode:null!==(d=null==t?void 0:t.retryMode)&&void 0!==d?d:Xt(Hn),sha256:null!==(l=null==t?void 0:t.sha256)&&void 0!==l?l:fn.bind(null,"sha256"),streamCollector:null!==(f=null==t?void 0:t.streamCollector)&&void 0!==f?f:Bn,utf8Decoder:null!==(v=null==t?void 0:t.utf8Decoder)&&void 0!==v?v:Jn,utf8Encoder:null!==(g=null==t?void 0:t.utf8Encoder)&&void 0!==g?g:Zn})},fi=function(t){function n(r){var i,o,s=this,a=li(r),u=At(a),c=yt(u),d=zn(c),l=dr((i=d,o={stsClientCtor:n}.stsClientCtor,st(e.__assign(e.__assign({},i),{stsClientCtor:o}))));return(s=t.call(this,l)||this).config=l,s.middlewareStack.use(_n(s.config)),s.middlewareStack.use(ir(s.config)),s.middlewareStack.use(ar(s.config)),s.middlewareStack.use(cr(s.config)),s.middlewareStack.use(Ir(s.config)),s}return e.__extends(n,t),n.prototype.destroy=function(){t.prototype.destroy.call(this)},n}(e.Client),vi=function(e){return void 0===e&&(e={}),pt(e,fi)};exports.Hash=fn,exports.NODE_MAX_ATTEMPT_CONFIG_OPTIONS=qn,exports.NODE_REGION_CONFIG_FILE_OPTIONS=St,exports.NODE_REGION_CONFIG_OPTIONS=wt,exports.NODE_RETRY_MODE_CONFIG_OPTIONS=Hn,exports.NodeHttpHandler=$n,exports.calculateBodyLength=Xn,exports.decorateDefaultCredentialProvider=function(t){return function(n){return t(e.__assign({roleAssumer:(r=n,void 0===r&&(r={}),ht(r,fi)),roleAssumerWithWebIdentity:vi(n)},n));var r}},exports.defaultProvider=si,exports.defaultUserAgent=Yn,exports.emitWarningIfUnsupportedVersion=F,exports.fromBase64=Vn,exports.fromHex=function(e){if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2){var r=e.substr(n,2).toLowerCase();if(!(r in Pe))throw new Error("Cannot decode unrecognized sequence "+r+" as hexadecimal");t[n/2]=Pe[r]}return t},exports.fromUtf8=Jn,exports.getAwsAuthPlugin=ft,exports.getContentLengthPlugin=ir,exports.getHostHeaderPlugin=ar,exports.getLoggerPlugin=cr,exports.getRegionInfo=Tt,exports.getRetryPlugin=_n,exports.getUserAgentPlugin=Ir,exports.loadConfig=Xt,exports.parseUrl=Jt,exports.resolveAwsAuthConfig=st,exports.resolveEndpointsConfig=yt,exports.resolveHostHeaderConfig=or,exports.resolveRegionConfig=At,exports.resolveRetryConfig=zn,exports.resolveUserAgentConfig=dr,exports.streamCollector=Bn,exports.toBase64=Gn,exports.toHex=Oe,exports.toUtf8=Zn;
