"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Queue = void 0;
const constructs_1 = require("constructs");
const cdk = __importStar(require("aws-cdk-lib"));
const sqs = __importStar(require("aws-cdk-lib/aws-sqs"));
const lambdaEventSources = __importStar(require("aws-cdk-lib/aws-lambda-event-sources"));
const Construct_1 = require("./Construct");
const Function_1 = require("./Function");
class Queue extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        const root = scope.node.root;
        const { 
        // Queue props
        sqsQueue, 
        // Function props
        consumer, } = props || {};
        this.permissionsAttachedForAllConsumers = [];
        ////////////////////
        // Create Queue
        ////////////////////
        if (Construct_1.isCDKConstruct(sqsQueue)) {
            this.sqsQueue = sqsQueue;
        }
        else {
            const sqsQueueProps = sqsQueue || {};
            // If debugIncreaseTimeout is enabled (ie. sst start):
            // - Set visibilityTimeout to > 900s. This is because Lambda timeout is
            //   set to 900s, and visibilityTimeout has to be greater or equal to it.
            //   This will give people more time to debug the function without timing
            //   out the request.
            let debugOverrideProps;
            if (root.debugIncreaseTimeout) {
                if (!sqsQueueProps.visibilityTimeout ||
                    sqsQueueProps.visibilityTimeout.toSeconds() < 900) {
                    debugOverrideProps = {
                        visibilityTimeout: cdk.Duration.seconds(900),
                    };
                }
            }
            const name = root.logicalPrefixedName(id) + (sqsQueueProps.fifo ? ".fifo" : "");
            this.sqsQueue = new sqs.Queue(this, "Queue", Object.assign(Object.assign({ queueName: name }, sqsQueueProps), (debugOverrideProps || {})));
        }
        ///////////////////////////
        // Create Consumer
        ///////////////////////////
        if (consumer) {
            this.addConsumer(this, consumer);
        }
    }
    addConsumer(scope, consumer) {
        if (this.consumerFunction) {
            throw new Error("Cannot configure more than 1 consumer for a Queue");
        }
        // Parse consumer props
        let consumerProps;
        let functionDefinition;
        if (consumer.function) {
            consumer = consumer;
            consumerProps = consumer.consumerProps;
            functionDefinition = consumer.function;
        }
        else {
            consumer = consumer;
            functionDefinition = consumer;
        }
        // Create function
        this.consumerFunction = Function_1.Function.fromDefinition(scope, `Consumer_${this.node.id}`, functionDefinition);
        this.consumerFunction.addEventSource(new lambdaEventSources.SqsEventSource(this.sqsQueue, consumerProps));
        // Attach permissions
        this.permissionsAttachedForAllConsumers.forEach((permissions) => {
            if (this.consumerFunction) {
                this.consumerFunction.attachPermissions(permissions);
            }
        });
    }
    attachPermissions(permissions) {
        if (this.consumerFunction) {
            this.consumerFunction.attachPermissions(permissions);
        }
        this.permissionsAttachedForAllConsumers.push(permissions);
    }
    getConstructMetadata() {
        return {
            type: "Queue",
            data: {
                name: this.sqsQueue.queueName,
                url: this.sqsQueue.queueUrl,
                consumer: Construct_1.getFunctionRef(this.consumerFunction),
            },
        };
    }
}
exports.Queue = Queue;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUXVldWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvUXVldWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUF1QztBQUN2QyxpREFBbUM7QUFDbkMseURBQTJDO0FBQzNDLHlGQUEyRTtBQUUzRSwyQ0FBMkU7QUFDM0UseUNBQWdFO0FBYWhFLE1BQWEsS0FBTSxTQUFRLHNCQUFTO0lBS2xDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBa0I7UUFDMUQsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQVcsQ0FBQztRQUNwQyxNQUFNO1FBQ0osY0FBYztRQUNkLFFBQVE7UUFDUixpQkFBaUI7UUFDakIsUUFBUSxHQUNULEdBQUcsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsa0NBQWtDLEdBQUcsRUFBRSxDQUFDO1FBRTdDLG9CQUFvQjtRQUNwQixlQUFlO1FBQ2Ysb0JBQW9CO1FBQ3BCLElBQUksMEJBQWMsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUM1QixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQXFCLENBQUM7U0FDdkM7YUFBTTtZQUNMLE1BQU0sYUFBYSxHQUFtQixRQUFRLElBQUksRUFBRSxDQUFDO1lBRXJELHNEQUFzRDtZQUN0RCx1RUFBdUU7WUFDdkUseUVBQXlFO1lBQ3pFLHlFQUF5RTtZQUN6RSxxQkFBcUI7WUFDckIsSUFBSSxrQkFBa0IsQ0FBQztZQUN2QixJQUFJLElBQUksQ0FBQyxvQkFBb0IsRUFBRTtnQkFDN0IsSUFDRSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUI7b0JBQ2hDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLEVBQUUsR0FBRyxHQUFHLEVBQ2pEO29CQUNBLGtCQUFrQixHQUFHO3dCQUNuQixpQkFBaUIsRUFBRSxHQUFHLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUM7cUJBQzdDLENBQUM7aUJBQ0g7YUFDRjtZQUVELE1BQU0sSUFBSSxHQUNSLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDckUsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLE9BQU8sZ0NBQ3pDLFNBQVMsRUFBRSxJQUFJLElBQ1osYUFBYSxHQUNiLENBQUMsa0JBQWtCLElBQUksRUFBRSxDQUFDLEVBQzdCLENBQUM7U0FDSjtRQUVELDJCQUEyQjtRQUMzQixrQkFBa0I7UUFDbEIsMkJBQTJCO1FBQzNCLElBQUksUUFBUSxFQUFFO1lBQ1osSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7U0FDbEM7SUFDSCxDQUFDO0lBRU0sV0FBVyxDQUNoQixLQUFnQixFQUNoQixRQUFpRDtRQUVqRCxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUN6QixNQUFNLElBQUksS0FBSyxDQUFDLG1EQUFtRCxDQUFDLENBQUM7U0FDdEU7UUFFRCx1QkFBdUI7UUFDdkIsSUFBSSxhQUFhLENBQUM7UUFDbEIsSUFBSSxrQkFBa0IsQ0FBQztRQUN2QixJQUFLLFFBQStCLENBQUMsUUFBUSxFQUFFO1lBQzdDLFFBQVEsR0FBRyxRQUE4QixDQUFDO1lBQzFDLGFBQWEsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDO1lBQ3ZDLGtCQUFrQixHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUM7U0FDeEM7YUFBTTtZQUNMLFFBQVEsR0FBRyxRQUE4QixDQUFDO1lBQzFDLGtCQUFrQixHQUFHLFFBQVEsQ0FBQztTQUMvQjtRQUVELGtCQUFrQjtRQUNsQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsbUJBQUUsQ0FBQyxjQUFjLENBQ3ZDLEtBQUssRUFDTCxZQUFZLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQzFCLGtCQUFrQixDQUNuQixDQUFDO1FBQ0YsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsQ0FDbEMsSUFBSSxrQkFBa0IsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxhQUFhLENBQUMsQ0FDcEUsQ0FBQztRQUVGLHFCQUFxQjtRQUNyQixJQUFJLENBQUMsa0NBQWtDLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUU7WUFDOUQsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7Z0JBQ3pCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQzthQUN0RDtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLGlCQUFpQixDQUFDLFdBQXdCO1FBQy9DLElBQUksSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3pCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUN0RDtRQUVELElBQUksQ0FBQyxrQ0FBa0MsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVNLG9CQUFvQjtRQUN6QixPQUFPO1lBQ0wsSUFBSSxFQUFFLE9BQWdCO1lBQ3RCLElBQUksRUFBRTtnQkFDSixJQUFJLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTO2dCQUM3QixHQUFHLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRO2dCQUMzQixRQUFRLEVBQUUsMEJBQWMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7YUFDaEQ7U0FDRixDQUFDO0lBQ0osQ0FBQztDQUNGO0FBbkhELHNCQW1IQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSBcImF3cy1jZGstbGliXCI7XG5pbXBvcnQgKiBhcyBzcXMgZnJvbSBcImF3cy1jZGstbGliL2F3cy1zcXNcIjtcbmltcG9ydCAqIGFzIGxhbWJkYUV2ZW50U291cmNlcyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWxhbWJkYS1ldmVudC1zb3VyY2VzXCI7XG5pbXBvcnQgeyBBcHAgfSBmcm9tIFwiLi9BcHBcIjtcbmltcG9ydCB7IGdldEZ1bmN0aW9uUmVmLCBTU1RDb25zdHJ1Y3QsIGlzQ0RLQ29uc3RydWN0IH0gZnJvbSBcIi4vQ29uc3RydWN0XCI7XG5pbXBvcnQgeyBGdW5jdGlvbiBhcyBGbiwgRnVuY3Rpb25EZWZpbml0aW9uIH0gZnJvbSBcIi4vRnVuY3Rpb25cIjtcbmltcG9ydCB7IFBlcm1pc3Npb25zIH0gZnJvbSBcIi4vdXRpbC9wZXJtaXNzaW9uXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUXVldWVQcm9wcyB7XG4gIHJlYWRvbmx5IHNxc1F1ZXVlPzogc3FzLklRdWV1ZSB8IHNxcy5RdWV1ZVByb3BzO1xuICByZWFkb25seSBjb25zdW1lcj86IEZ1bmN0aW9uRGVmaW5pdGlvbiB8IFF1ZXVlQ29uc3VtZXJQcm9wcztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBRdWV1ZUNvbnN1bWVyUHJvcHMge1xuICByZWFkb25seSBmdW5jdGlvbjogRnVuY3Rpb25EZWZpbml0aW9uO1xuICByZWFkb25seSBjb25zdW1lclByb3BzPzogbGFtYmRhRXZlbnRTb3VyY2VzLlNxc0V2ZW50U291cmNlUHJvcHM7XG59XG5cbmV4cG9ydCBjbGFzcyBRdWV1ZSBleHRlbmRzIENvbnN0cnVjdCBpbXBsZW1lbnRzIFNTVENvbnN0cnVjdCB7XG4gIHB1YmxpYyByZWFkb25seSBzcXNRdWV1ZTogc3FzLlF1ZXVlO1xuICBwdWJsaWMgY29uc3VtZXJGdW5jdGlvbj86IEZuO1xuICBwcml2YXRlIHJlYWRvbmx5IHBlcm1pc3Npb25zQXR0YWNoZWRGb3JBbGxDb25zdW1lcnM6IFBlcm1pc3Npb25zW107XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM/OiBRdWV1ZVByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIGNvbnN0IHJvb3QgPSBzY29wZS5ub2RlLnJvb3QgYXMgQXBwO1xuICAgIGNvbnN0IHtcbiAgICAgIC8vIFF1ZXVlIHByb3BzXG4gICAgICBzcXNRdWV1ZSxcbiAgICAgIC8vIEZ1bmN0aW9uIHByb3BzXG4gICAgICBjb25zdW1lcixcbiAgICB9ID0gcHJvcHMgfHwge307XG4gICAgdGhpcy5wZXJtaXNzaW9uc0F0dGFjaGVkRm9yQWxsQ29uc3VtZXJzID0gW107XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIENyZWF0ZSBRdWV1ZVxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgaWYgKGlzQ0RLQ29uc3RydWN0KHNxc1F1ZXVlKSkge1xuICAgICAgdGhpcy5zcXNRdWV1ZSA9IHNxc1F1ZXVlIGFzIHNxcy5RdWV1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc3FzUXVldWVQcm9wczogc3FzLlF1ZXVlUHJvcHMgPSBzcXNRdWV1ZSB8fCB7fTtcblxuICAgICAgLy8gSWYgZGVidWdJbmNyZWFzZVRpbWVvdXQgaXMgZW5hYmxlZCAoaWUuIHNzdCBzdGFydCk6XG4gICAgICAvLyAtIFNldCB2aXNpYmlsaXR5VGltZW91dCB0byA+IDkwMHMuIFRoaXMgaXMgYmVjYXVzZSBMYW1iZGEgdGltZW91dCBpc1xuICAgICAgLy8gICBzZXQgdG8gOTAwcywgYW5kIHZpc2liaWxpdHlUaW1lb3V0IGhhcyB0byBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIGl0LlxuICAgICAgLy8gICBUaGlzIHdpbGwgZ2l2ZSBwZW9wbGUgbW9yZSB0aW1lIHRvIGRlYnVnIHRoZSBmdW5jdGlvbiB3aXRob3V0IHRpbWluZ1xuICAgICAgLy8gICBvdXQgdGhlIHJlcXVlc3QuXG4gICAgICBsZXQgZGVidWdPdmVycmlkZVByb3BzO1xuICAgICAgaWYgKHJvb3QuZGVidWdJbmNyZWFzZVRpbWVvdXQpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICFzcXNRdWV1ZVByb3BzLnZpc2liaWxpdHlUaW1lb3V0IHx8XG4gICAgICAgICAgc3FzUXVldWVQcm9wcy52aXNpYmlsaXR5VGltZW91dC50b1NlY29uZHMoKSA8IDkwMFxuICAgICAgICApIHtcbiAgICAgICAgICBkZWJ1Z092ZXJyaWRlUHJvcHMgPSB7XG4gICAgICAgICAgICB2aXNpYmlsaXR5VGltZW91dDogY2RrLkR1cmF0aW9uLnNlY29uZHMoOTAwKSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG5hbWUgPVxuICAgICAgICByb290LmxvZ2ljYWxQcmVmaXhlZE5hbWUoaWQpICsgKHNxc1F1ZXVlUHJvcHMuZmlmbyA/IFwiLmZpZm9cIiA6IFwiXCIpO1xuICAgICAgdGhpcy5zcXNRdWV1ZSA9IG5ldyBzcXMuUXVldWUodGhpcywgXCJRdWV1ZVwiLCB7XG4gICAgICAgIHF1ZXVlTmFtZTogbmFtZSxcbiAgICAgICAgLi4uc3FzUXVldWVQcm9wcyxcbiAgICAgICAgLi4uKGRlYnVnT3ZlcnJpZGVQcm9wcyB8fCB7fSksXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBDcmVhdGUgQ29uc3VtZXJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICBpZiAoY29uc3VtZXIpIHtcbiAgICAgIHRoaXMuYWRkQ29uc3VtZXIodGhpcywgY29uc3VtZXIpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhZGRDb25zdW1lcihcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIGNvbnN1bWVyOiBGdW5jdGlvbkRlZmluaXRpb24gfCBRdWV1ZUNvbnN1bWVyUHJvcHNcbiAgKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY29uc3VtZXJGdW5jdGlvbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGNvbmZpZ3VyZSBtb3JlIHRoYW4gMSBjb25zdW1lciBmb3IgYSBRdWV1ZVwiKTtcbiAgICB9XG5cbiAgICAvLyBQYXJzZSBjb25zdW1lciBwcm9wc1xuICAgIGxldCBjb25zdW1lclByb3BzO1xuICAgIGxldCBmdW5jdGlvbkRlZmluaXRpb247XG4gICAgaWYgKChjb25zdW1lciBhcyBRdWV1ZUNvbnN1bWVyUHJvcHMpLmZ1bmN0aW9uKSB7XG4gICAgICBjb25zdW1lciA9IGNvbnN1bWVyIGFzIFF1ZXVlQ29uc3VtZXJQcm9wcztcbiAgICAgIGNvbnN1bWVyUHJvcHMgPSBjb25zdW1lci5jb25zdW1lclByb3BzO1xuICAgICAgZnVuY3Rpb25EZWZpbml0aW9uID0gY29uc3VtZXIuZnVuY3Rpb247XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN1bWVyID0gY29uc3VtZXIgYXMgRnVuY3Rpb25EZWZpbml0aW9uO1xuICAgICAgZnVuY3Rpb25EZWZpbml0aW9uID0gY29uc3VtZXI7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGZ1bmN0aW9uXG4gICAgdGhpcy5jb25zdW1lckZ1bmN0aW9uID0gRm4uZnJvbURlZmluaXRpb24oXG4gICAgICBzY29wZSxcbiAgICAgIGBDb25zdW1lcl8ke3RoaXMubm9kZS5pZH1gLFxuICAgICAgZnVuY3Rpb25EZWZpbml0aW9uXG4gICAgKTtcbiAgICB0aGlzLmNvbnN1bWVyRnVuY3Rpb24uYWRkRXZlbnRTb3VyY2UoXG4gICAgICBuZXcgbGFtYmRhRXZlbnRTb3VyY2VzLlNxc0V2ZW50U291cmNlKHRoaXMuc3FzUXVldWUsIGNvbnN1bWVyUHJvcHMpXG4gICAgKTtcblxuICAgIC8vIEF0dGFjaCBwZXJtaXNzaW9uc1xuICAgIHRoaXMucGVybWlzc2lvbnNBdHRhY2hlZEZvckFsbENvbnN1bWVycy5mb3JFYWNoKChwZXJtaXNzaW9ucykgPT4ge1xuICAgICAgaWYgKHRoaXMuY29uc3VtZXJGdW5jdGlvbikge1xuICAgICAgICB0aGlzLmNvbnN1bWVyRnVuY3Rpb24uYXR0YWNoUGVybWlzc2lvbnMocGVybWlzc2lvbnMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGF0dGFjaFBlcm1pc3Npb25zKHBlcm1pc3Npb25zOiBQZXJtaXNzaW9ucyk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbnN1bWVyRnVuY3Rpb24pIHtcbiAgICAgIHRoaXMuY29uc3VtZXJGdW5jdGlvbi5hdHRhY2hQZXJtaXNzaW9ucyhwZXJtaXNzaW9ucyk7XG4gICAgfVxuXG4gICAgdGhpcy5wZXJtaXNzaW9uc0F0dGFjaGVkRm9yQWxsQ29uc3VtZXJzLnB1c2gocGVybWlzc2lvbnMpO1xuICB9XG5cbiAgcHVibGljIGdldENvbnN0cnVjdE1ldGFkYXRhKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIlF1ZXVlXCIgYXMgY29uc3QsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG5hbWU6IHRoaXMuc3FzUXVldWUucXVldWVOYW1lLFxuICAgICAgICB1cmw6IHRoaXMuc3FzUXVldWUucXVldWVVcmwsXG4gICAgICAgIGNvbnN1bWVyOiBnZXRGdW5jdGlvblJlZih0aGlzLmNvbnN1bWVyRnVuY3Rpb24pLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG4iXX0=