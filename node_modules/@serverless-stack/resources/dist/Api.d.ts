import { Construct } from "constructs";
import * as acm from "aws-cdk-lib/aws-certificatemanager";
import * as apig from "@aws-cdk/aws-apigatewayv2-alpha";
import * as apigAuthorizers from "@aws-cdk/aws-apigatewayv2-authorizers-alpha";
import * as elb from "aws-cdk-lib/aws-elasticloadbalancingv2";
import * as logs from "aws-cdk-lib/aws-logs";
import { SSTConstruct } from "./Construct";
import { Function as Fn, FunctionProps, FunctionDefinition } from "./Function";
import { Permissions } from "./util/permission";
import * as apigV2Domain from "./util/apiGatewayV2Domain";
import * as apigV2AccessLog from "./util/apiGatewayV2AccessLog";
export declare enum ApiAuthorizationType {
    JWT = "JWT",
    NONE = "NONE",
    CUSTOM = "CUSTOM",
    AWS_IAM = "AWS_IAM"
}
export declare enum ApiPayloadFormatVersion {
    V1 = "1.0",
    V2 = "2.0"
}
export interface ApiProps {
    readonly httpApi?: apig.IHttpApi | apig.HttpApiProps;
    readonly routes?: {
        [key: string]: FunctionDefinition | ApiFunctionRouteProps | ApiHttpRouteProps | ApiAlbRouteProps;
    };
    readonly cors?: boolean | apig.CorsPreflightOptions;
    readonly accessLog?: boolean | string | ApiAccessLogProps;
    readonly customDomain?: string | ApiCustomDomainProps;
    readonly defaultFunctionProps?: FunctionProps;
    readonly defaultAuthorizationType?: ApiAuthorizationType;
    readonly defaultAuthorizer?: apigAuthorizers.HttpJwtAuthorizer | apigAuthorizers.HttpLambdaAuthorizer | apigAuthorizers.HttpUserPoolAuthorizer;
    readonly defaultAuthorizationScopes?: string[];
    readonly defaultPayloadFormatVersion?: ApiPayloadFormatVersion;
    readonly defaultThrottlingBurstLimit?: number;
    readonly defaultThrottlingRateLimit?: number;
    readonly stages?: Omit<apig.HttpStageProps, "httpApi">[];
}
export interface ApiFunctionRouteProps {
    readonly function: FunctionDefinition;
    readonly payloadFormatVersion?: ApiPayloadFormatVersion;
    readonly authorizationType?: ApiAuthorizationType;
    readonly authorizer?: apigAuthorizers.HttpJwtAuthorizer | apigAuthorizers.HttpLambdaAuthorizer | apigAuthorizers.HttpUserPoolAuthorizer;
    readonly authorizationScopes?: string[];
}
export interface ApiHttpRouteProps {
    readonly url: string;
    readonly method?: string | apig.HttpMethod;
    readonly authorizationType?: ApiAuthorizationType;
    readonly authorizer?: apigAuthorizers.HttpJwtAuthorizer | apigAuthorizers.HttpLambdaAuthorizer | apigAuthorizers.HttpUserPoolAuthorizer;
    readonly authorizationScopes?: string[];
}
export interface ApiAlbRouteProps {
    readonly albListener: elb.IApplicationListener;
    readonly method?: string | apig.HttpMethod;
    readonly vpcLink?: apig.IVpcLink;
    readonly authorizationType?: ApiAuthorizationType;
    readonly authorizer?: apigAuthorizers.HttpJwtAuthorizer | apigAuthorizers.HttpLambdaAuthorizer | apigAuthorizers.HttpUserPoolAuthorizer;
    readonly authorizationScopes?: string[];
}
export declare type ApiCustomDomainProps = apigV2Domain.CustomDomainProps;
export declare type ApiAccessLogProps = apigV2AccessLog.AccessLogProps;
export declare class Api extends Construct implements SSTConstruct {
    readonly httpApi: apig.HttpApi;
    readonly accessLogGroup?: logs.LogGroup;
    readonly apiGatewayDomain?: apig.DomainName;
    readonly acmCertificate?: acm.Certificate;
    private readonly _customDomainUrl?;
    private readonly routesData;
    private readonly permissionsAttachedForAllRoutes;
    private readonly defaultFunctionProps?;
    private readonly defaultAuthorizer?;
    private readonly defaultAuthorizationType?;
    private readonly defaultAuthorizationScopes?;
    private readonly defaultPayloadFormatVersion?;
    private readonly defaultThrottlingBurstLimit?;
    private readonly defaultThrottlingRateLimit?;
    constructor(scope: Construct, id: string, props?: ApiProps);
    get url(): string;
    get customDomainUrl(): string | undefined;
    get routes(): string[];
    get httpApiArn(): string;
    addRoutes(scope: Construct, routes: {
        [key: string]: FunctionDefinition | ApiFunctionRouteProps | ApiHttpRouteProps | ApiAlbRouteProps;
    }): void;
    getFunction(routeKey: string): Fn | undefined;
    attachPermissions(permissions: Permissions): void;
    attachPermissionsToRoute(routeKey: string, permissions: Permissions): void;
    getConstructMetadata(): {
        type: "Api";
        data: {
            httpApiId: string;
            customDomainUrl: string | undefined;
            routes: {
                route: string;
                fn: {
                    node: string;
                    stack: string;
                } | undefined;
            }[];
        };
    };
    private buildCorsConfig;
    private addRoute;
    private createHttpIntegration;
    private createAlbIntegration;
    protected createFunctionIntegration(scope: Construct, routeKey: string, routeProps: ApiFunctionRouteProps, postfixName: string): apig.HttpRouteIntegration;
    private buildRouteAuth;
    private normalizeRouteKey;
    private buildHttpMethod;
}
