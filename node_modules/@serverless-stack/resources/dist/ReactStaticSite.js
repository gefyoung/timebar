"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ReactStaticSite = void 0;
const path = __importStar(require("path"));
const fs = __importStar(require("fs-extra"));
const StaticSite_1 = require("./StaticSite");
/////////////////////
// Construct
/////////////////////
class ReactStaticSite extends StaticSite_1.StaticSite {
    constructor(scope, id, props) {
        const { path: sitePath, environment } = props || {};
        // Validate environment
        Object.keys(environment || {}).forEach((key) => {
            if (!key.startsWith("REACT_APP_")) {
                throw new Error(`Environment variables in the "${id}" ReactStaticSite must start with "REACT_APP_".`);
            }
        });
        // generate buildCommand
        let defaultBuildCommand = "npm run build";
        if (fs.existsSync(path.join(sitePath, "yarn.lock"))) {
            defaultBuildCommand = "yarn build";
        }
        super(scope, id, Object.assign({ indexPage: "index.html", errorPage: StaticSite_1.StaticSiteErrorOptions.REDIRECT_TO_INDEX_PAGE, buildCommand: defaultBuildCommand, buildOutput: "build", fileOptions: [
                {
                    exclude: "*",
                    include: "*.html",
                    cacheControl: "max-age=0,no-cache,no-store,must-revalidate",
                },
                {
                    exclude: "*",
                    include: ["*.js", "*.css"],
                    cacheControl: "max-age=31536000,public,immutable",
                },
            ] }, props));
    }
}
exports.ReactStaticSite = ReactStaticSite;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVhY3RTdGF0aWNTaXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1JlYWN0U3RhdGljU2l0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQTZCO0FBQzdCLDZDQUErQjtBQUcvQiw2Q0FJc0I7QUFXdEIscUJBQXFCO0FBQ3JCLFlBQVk7QUFDWixxQkFBcUI7QUFFckIsTUFBYSxlQUFnQixTQUFRLHVCQUFVO0lBQzdDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBc0I7UUFDOUQsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLEdBQUcsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUVwRCx1QkFBdUI7UUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7WUFDN0MsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLEVBQUU7Z0JBQ2pDLE1BQU0sSUFBSSxLQUFLLENBQ2IsaUNBQWlDLEVBQUUsaURBQWlELENBQ3JGLENBQUM7YUFDSDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsd0JBQXdCO1FBQ3hCLElBQUksbUJBQW1CLEdBQUcsZUFBZSxDQUFDO1FBQzFDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsQ0FBQyxFQUFFO1lBQ25ELG1CQUFtQixHQUFHLFlBQVksQ0FBQztTQUNwQztRQUVELEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxrQkFDYixTQUFTLEVBQUUsWUFBWSxFQUN2QixTQUFTLEVBQUUsbUNBQXNCLENBQUMsc0JBQXNCLEVBQ3hELFlBQVksRUFBRSxtQkFBbUIsRUFDakMsV0FBVyxFQUFFLE9BQU8sRUFDcEIsV0FBVyxFQUFFO2dCQUNYO29CQUNFLE9BQU8sRUFBRSxHQUFHO29CQUNaLE9BQU8sRUFBRSxRQUFRO29CQUNqQixZQUFZLEVBQUUsNkNBQTZDO2lCQUM1RDtnQkFDRDtvQkFDRSxPQUFPLEVBQUUsR0FBRztvQkFDWixPQUFPLEVBQUUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDO29CQUMxQixZQUFZLEVBQUUsbUNBQW1DO2lCQUNsRDthQUNGLElBQ0UsS0FBSyxFQUNSLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUF2Q0QsMENBdUNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzLWV4dHJhXCI7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tIFwiY29uc3RydWN0c1wiO1xuXG5pbXBvcnQge1xuICBTdGF0aWNTaXRlLFxuICBTdGF0aWNTaXRlUHJvcHMsXG4gIFN0YXRpY1NpdGVFcnJvck9wdGlvbnMsXG59IGZyb20gXCIuL1N0YXRpY1NpdGVcIjtcblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBJbnRlcmZhY2VzXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuLyoqXG4gKiBAZGVwcmVjYXRlZCBUaGlzIHR5cGUgaGFzIGJlZW4gcmVwbGFjZWQgYnkgdGhlIHN0YW5kYXJkIFN0YXRpY1NpdGVQcm9wc1xuICovXG5leHBvcnQgdHlwZSBSZWFjdFN0YXRpY1NpdGVQcm9wcyA9IFN0YXRpY1NpdGVQcm9wcztcblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBDb25zdHJ1Y3Rcbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5leHBvcnQgY2xhc3MgUmVhY3RTdGF0aWNTaXRlIGV4dGVuZHMgU3RhdGljU2l0ZSB7XG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBTdGF0aWNTaXRlUHJvcHMpIHtcbiAgICBjb25zdCB7IHBhdGg6IHNpdGVQYXRoLCBlbnZpcm9ubWVudCB9ID0gcHJvcHMgfHwge307XG5cbiAgICAvLyBWYWxpZGF0ZSBlbnZpcm9ubWVudFxuICAgIE9iamVjdC5rZXlzKGVudmlyb25tZW50IHx8IHt9KS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIGlmICgha2V5LnN0YXJ0c1dpdGgoXCJSRUFDVF9BUFBfXCIpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgRW52aXJvbm1lbnQgdmFyaWFibGVzIGluIHRoZSBcIiR7aWR9XCIgUmVhY3RTdGF0aWNTaXRlIG11c3Qgc3RhcnQgd2l0aCBcIlJFQUNUX0FQUF9cIi5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBnZW5lcmF0ZSBidWlsZENvbW1hbmRcbiAgICBsZXQgZGVmYXVsdEJ1aWxkQ29tbWFuZCA9IFwibnBtIHJ1biBidWlsZFwiO1xuICAgIGlmIChmcy5leGlzdHNTeW5jKHBhdGguam9pbihzaXRlUGF0aCwgXCJ5YXJuLmxvY2tcIikpKSB7XG4gICAgICBkZWZhdWx0QnVpbGRDb21tYW5kID0gXCJ5YXJuIGJ1aWxkXCI7XG4gICAgfVxuXG4gICAgc3VwZXIoc2NvcGUsIGlkLCB7XG4gICAgICBpbmRleFBhZ2U6IFwiaW5kZXguaHRtbFwiLFxuICAgICAgZXJyb3JQYWdlOiBTdGF0aWNTaXRlRXJyb3JPcHRpb25zLlJFRElSRUNUX1RPX0lOREVYX1BBR0UsXG4gICAgICBidWlsZENvbW1hbmQ6IGRlZmF1bHRCdWlsZENvbW1hbmQsXG4gICAgICBidWlsZE91dHB1dDogXCJidWlsZFwiLFxuICAgICAgZmlsZU9wdGlvbnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGV4Y2x1ZGU6IFwiKlwiLFxuICAgICAgICAgIGluY2x1ZGU6IFwiKi5odG1sXCIsXG4gICAgICAgICAgY2FjaGVDb250cm9sOiBcIm1heC1hZ2U9MCxuby1jYWNoZSxuby1zdG9yZSxtdXN0LXJldmFsaWRhdGVcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGV4Y2x1ZGU6IFwiKlwiLFxuICAgICAgICAgIGluY2x1ZGU6IFtcIiouanNcIiwgXCIqLmNzc1wiXSxcbiAgICAgICAgICBjYWNoZUNvbnRyb2w6IFwibWF4LWFnZT0zMTUzNjAwMCxwdWJsaWMsaW1tdXRhYmxlXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgLi4ucHJvcHMsXG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==