"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.artifactsPath = exports.read = exports.append = exports.reset = void 0;
const state_1 = require("./state");
const path_1 = __importDefault(require("path"));
const fs_extra_1 = __importDefault(require("fs-extra"));
const FILE_NAME = "functions.jsonl";
function reset(root) {
    fs_extra_1.default.removeSync(definitionsPath(root));
}
exports.reset = reset;
function append(root, def) {
    fs_extra_1.default.appendFileSync(definitionsPath(root), JSON.stringify({
        ...def,
        root,
    }) + "\n");
}
exports.append = append;
function read(root) {
    if (!fs_extra_1.default.existsSync(definitionsPath(root)))
        return [];
    const data = fs_extra_1.default.readFileSync(definitionsPath(root), "utf8");
    return data
        .split("\n")
        .filter(Boolean)
        .map((line) => JSON.parse(line));
}
exports.read = read;
function definitionsPath(root) {
    return (0, state_1.resolve)(root, FILE_NAME);
}
function artifactsPath(root, target) {
    return (0, state_1.resolve)(root, path_1.default.join("artifacts", target));
}
exports.artifactsPath = artifactsPath;
